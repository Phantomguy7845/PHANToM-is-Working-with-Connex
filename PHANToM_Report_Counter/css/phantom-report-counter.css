/* =======================================================
   PHANToM Report Counter — Aurora 2025 · 3-Level + Calc
   ======================================================= */

:root{
  --bg:#0b1220; --panel:#111b30; --edge:#243353; --txt:#e5e7eb; --muted:#8fa1c6;
  --pri:#3b82f6; --ok:#22c55e; --warn:#f59e0b; --err:#ef4444;
  --card-radius:12px; --shadow:0 8px 28px rgba(0,0,0,.25);
}

*{box-sizing:border-box}
body{
  margin:0; background:var(--bg); color:var(--txt);
  font-family:"Prompt",system-ui,sans-serif;
  min-height:100vh; display:flex; flex-direction:column;
}

/* Header */
header{
  background:linear-gradient(90deg,#0f182a,#152238);
  padding:12px 18px; display:flex; align-items:center; justify-content:space-between; gap:10px; flex-wrap:wrap;
  border-bottom:1px solid #223;
}
header input, header select{
  background:#1a2238; border:1px solid #334; color:var(--txt);
  border-radius:8px; padding:8px 10px; font-size:.95rem;
}

/* Buttons */
button{border:none;border-radius:10px;padding:8px 12px;font-size:.95rem;cursor:pointer;transition:.2s ease}
button:hover{opacity:.92;transform:translateY(-1px)}
.btn{background:var(--pri);color:#fff}
.ghost{background:#1a2238;color:var(--muted);border:1px solid #334}
.warn{background:var(--warn);color:#000}
.danger{background:var(--err);color:#fff}
.mini{background:#1c2a44;color:var(--txt);border:1px solid #334;width:28px;height:28px;border-radius:50%;display:inline-flex;align-items:center;justify-content:center;line-height:0}

/* Tree board */
#tree{padding:16px 18px;display:flex;flex-direction:column;gap:16px;flex:1}

/* Node shells */
.node{background:var(--panel);border:1px solid var(--edge);border-radius:var(--card-radius);box-shadow:var(--shadow);transition:.2s ease}
.node.selected{border-color:var(--pri);box-shadow:0 0 0 2px rgba(59,130,246,.35)}
.node .header, .node .sub-header{display:flex;align-items:center;gap:10px;flex-wrap:wrap}

/* Main node = sheet */
.node.main{
  background:linear-gradient(180deg,#101b33,#0a0f1f);
  border:2px solid var(--pri);
  padding:18px 20px; border-radius:16px;
}
.node.main .title{font-weight:800;font-size:1.05rem}
.node.main .children{margin-top:8px}

/* Level2 node = paragraph bar */
.node.level2{padding:12px;border-radius:12px;margin:8px 0}
.node.level2 .title{font-weight:700}
.node.level2 .children{margin-top:6px}
.node.level2.has-children .modeWrap{display:none}  /* hide self mode when has level3 */

/* Level3 node = small boxes grid */
.level3-wrap{display:flex;flex-wrap:wrap;gap:8px}
.node.level3{
  display:inline-flex;flex-direction:column;gap:6px;
  background:#1a2238;border:1px solid var(--edge);
  border-radius:10px;padding:8px 10px;min-width:200px;max-width:520px;resize:both;overflow:auto;
}

/* Calc node */
.node.calc{background:linear-gradient(180deg,#163a36,#0f2724);border:2px solid var(--ok)}
.node.calc .formula{background:rgba(0,0,0,.25);border:1px solid #2c5;color:#9ef3c8;padding:6px 8px;border-radius:8px;font-family:ui-monospace,Consolas,monospace}

/* SUM Section (bottom fixed) */
.node.sum{border-top:2px dashed var(--pri);padding-top:18px;margin-top:8px}
.node.sum .title{font-weight:800}

/* Common bits */
.title{min-width:120px}
.badge{font-size:.8rem;background:#1a2238;color:var(--muted);padding:3px 8px;border-radius:6px}
.countWrap{display:flex;align-items:center;gap:8px;flex:1}
.modeWrap{display:flex;align-items:center;gap:8px}
.count{background:#1a2238;border:1px solid #334;border-radius:8px;padding:6px 12px;min-width:42px;text-align:center;cursor:pointer}
.textbox{
  width:100%;min-height:120px;resize:vertical;background:rgba(15,25,45,.95);
  border:1px solid #334;border-radius:8px;color:var(--txt);padding:10px 12px;font-size:.95rem;line-height:1.5;
}
.textbox:focus{border-color:var(--pri);box-shadow:0 0 0 2px rgba(59,130,246,.35)}

.row{display:flex;align-items:center;gap:8px;margin-top:8px}
.row input,.row select{background:#1a2238;border:1px solid #334;color:var(--txt);border-radius:8px;padding:6px 10px}

/* Formula modal */
.modal{border:none;border-radius:16px;padding:0;max-width:680px;width:calc(100% - 24px);background:#0e172e;color:var(--txt)}
.modal::backdrop{background:rgba(0,0,0,.45)}
.modal-card{padding:0}
.modal-head{display:flex;align-items:center;justify-content:space-between;padding:12px 14px;border-bottom:1px solid var(--edge)}
.modal-body{padding:12px 14px;display:flex;flex-direction:column;gap:10px}
.modal-foot{padding:12px 14px;border-top:1px solid var(--edge);display:flex;justify-content:flex-end}
.formula-line{display:flex;gap:8px;align-items:center}
.formula-list{display:flex;flex-direction:column;gap:6px}
.muted{color:var(--muted);font-size:.9rem}

/* Toast */
#toast{
  position:fixed;left:50%;bottom:18px;transform:translate(-50%,24px);
  background:#0f1b2d;border:1px solid var(--pri);color:#fff;padding:8px 14px;border-radius:10px;opacity:0;transition:.25s ease
}
#toast.show{opacity:1;transform:translate(-50%,0)}

/* Responsive */
@media (max-width:900px){
  .level3-wrap{gap:10px}
}
