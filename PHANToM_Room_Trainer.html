<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>PHANToM Room Trainer ‚Äî Offline</title>
<style>
:root {
  --bg1:#080d1a; --bg2:#0e1730; --txt:#e6ebf3; --pri:#6b8bff; --a1:#8bf5ff;
  --ok:#22c55e; --warn:#f59e0b; --err:#ef4444;
}
*{box-sizing:border-box;font-family:'Prompt',system-ui,sans-serif}
body{
  margin:0;background:radial-gradient(900px 700px at 20% 20%,var(--bg2),var(--bg1));
  color:var(--txt);min-height:100vh;padding:12px;
}
header{
  display:flex;justify-content:space-between;align-items:center;
  padding:10px 14px;border-bottom:1px solid rgba(255,255,255,.08);
  background:rgba(255,255,255,.03);
}
h1{margin:0;font-size:1.3rem;font-weight:700}
main{margin-top:14px;display:flex;flex-direction:column;gap:14px}
.card{
  background:rgba(255,255,255,.04);
  border:1px solid rgba(255,255,255,.1);
  border-radius:16px;padding:14px;box-shadow:0 8px 24px rgba(0,0,0,.3);
}
button{
  border:none;border-radius:10px;padding:8px 14px;margin:3px;cursor:pointer;
  font-weight:600;color:#fff;background:var(--pri);
}
button:hover{filter:brightness(1.1)}
button.warn{background:var(--warn);color:#000}
button.ok{background:var(--ok)}
button.secondary{background:#132044}
input,select{
  background:#0f1b39;border:1px solid rgba(255,255,255,.15);
  color:var(--txt);border-radius:8px;padding:8px;
}
.grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(160px,1fr));gap:10px;margin-top:10px}
.cell{background:#0e1633;border:1px solid rgba(255,255,255,.08);border-radius:10px;padding:6px}
.cell h3{margin:4px 0 6px;font-size:.9rem}
.imgs{display:flex;flex-wrap:wrap;gap:6px}
.imgs img{width:70px;height:70px;object-fit:cover;border-radius:6px}
.status{margin-top:6px;font-size:.9rem;opacity:.8}
</style>
</head>
<body>
<header>
  <h1>PHANToM Room Trainer</h1>
  <div>by PHANToM</div>
</header>

<main>
  <section class="card">
    <p>‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô: ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå ‚Üí ‡∏ï‡∏±‡πâ‡∏á‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏°‡∏ß‡∏î ‚Üí ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ä‡∏∏‡∏î‡∏†‡∏≤‡∏û ‚Üí ‡∏Å‡∏î ‚Äú‡πÄ‡∏ó‡∏£‡∏ô‚Äù ‚Üí ‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡πÇ‡∏°‡πÄ‡∏î‡∏• (‡πÑ‡∏î‡πâ <b>model.json</b> + <b>model.weights.bin</b>)</p>
    <div style="display:flex;flex-wrap:wrap;gap:8px;align-items:center">
      <input type="file" id="picker" multiple accept="image/*">
      <input type="text" id="labelName" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏°‡∏ß‡∏î (‡πÄ‡∏ä‡πà‡∏ô living)" style="flex:1">
      <button id="addSet" class="ok">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ä‡∏∏‡∏î‡∏†‡∏≤‡∏û</button>
      <button id="train" class="secondary">‡πÄ‡∏ó‡∏£‡∏ô</button>
      <button id="export" class="ok">‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡πÇ‡∏°‡πÄ‡∏î‡∏•</button>
      <button id="clear" class="warn">‡∏•‡πâ‡∏≤‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
    </div>
    <div id="status" class="status">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡πÇ‡∏°‡πÄ‡∏î‡∏• MobileNet...</div>
  </section>

  <section class="card" id="dataset">
    <p>‡∏´‡∏°‡∏ß‡∏î (‡∏•‡∏≤‡∏Å‡∏†‡∏≤‡∏û‡πÄ‡∏Ç‡πâ‡∏≤‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏´‡∏°‡∏ß‡∏î‡πÑ‡∏î‡πâ)</p>
    <div id="grid" class="grid"></div>
  </section>
</main>

<script src="https://cdn.jsdelivr.net/npm/ml5@0.12.2/dist/ml5.min.js"></script>
<script>
let fx, clf, currentLabel='', dataMap={};

function setStatus(t){ document.getElementById('status').textContent=t; console.log(t); }

// ‡πÇ‡∏´‡∏•‡∏î MobileNet
setStatus('‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î MobileNet...');
fx = ml5.featureExtractor('MobileNet', {numLabels:20}, ()=>{
  clf = fx.classification();
  setStatus('‚úÖ ‡πÇ‡∏´‡∏•‡∏î MobileNet ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÄ‡∏ó‡∏£‡∏ô');
});

document.getElementById('addSet').onclick=()=>{
  const lbl=document.getElementById('labelName').value.trim();
  const files=document.getElementById('picker').files;
  if(!lbl || files.length==0){ alert('‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏°‡∏ß‡∏î‡πÅ‡∏•‡∏∞‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏†‡∏≤‡∏û'); return; }
  if(!dataMap[lbl]){
    dataMap[lbl]=[];
    const c=document.createElement('div');c.className='cell';c.innerHTML=`<h3>${lbl}</h3><div class="imgs" id="img-${lbl}"></div>`;
    document.getElementById('grid').appendChild(c);
  }
  const container=document.getElementById('img-'+lbl);
  [...files].forEach(f=>{
    const img=document.createElement('img');
    img.src=URL.createObjectURL(f);
    container.appendChild(img);
    clf.addImage(img,lbl);
    dataMap[lbl].push(img);
  });
  setStatus(`‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏†‡∏≤‡∏û‡πÄ‡∏Ç‡πâ‡∏≤ "${lbl}" ‡πÅ‡∏•‡πâ‡∏ß (${files.length} ‡∏£‡∏π‡∏õ)`);
};

document.getElementById('train').onclick=()=>{
  if(!clf){ alert('‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÄ‡∏ó‡∏£‡∏ô'); return; }
  setStatus('üöÄ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏ó‡∏£‡∏ô...');
  clf.train(l=>{
    let val=(typeof l==='object'&&l!==null)?l.loss:l;
    if(val==null){ setStatus('‚úÖ ‡πÄ‡∏ó‡∏£‡∏ô‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å'); }
    else{ setStatus(`Loss: ${Number(val).toFixed(4)}`); }
  });
};

document.getElementById('export').onclick=()=>{
  if(!clf){ alert('‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÇ‡∏°‡πÄ‡∏î‡∏•'); return; }
  clf.save(()=>setStatus('üíæ ‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡πÇ‡∏°‡πÄ‡∏î‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢ (model.json + weights.bin)'));
};

document.getElementById('clear').onclick=()=>{
  dataMap={};document.getElementById('grid').innerHTML='';
  setStatus('‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÅ‡∏•‡πâ‡∏ß');
};
</script>
</body>
</html>
