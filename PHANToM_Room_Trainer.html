<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>PHANToM Room Trainer</title>
<style>
body{margin:0;background:#0a1020;color:#e5e7eb;font-family:system-ui,'Prompt',sans-serif;display:flex;flex-direction:column;align-items:center;min-height:100vh}
h1{margin:20px 0;text-shadow:0 0 10px #8bf5ff}
.container{max-width:600px;width:90%;background:rgba(255,255,255,.03);padding:20px;border-radius:14px;box-shadow:0 0 20px rgba(0,0,0,.4)}
button{padding:10px 16px;border:none;border-radius:10px;cursor:pointer;font-weight:700;margin:4px}
#status{margin-top:10px;font-size:.9rem;color:#8bf5ff}
input[type=file]{margin:10px 0}
</style>
<script src="https://cdn.jsdelivr.net/npm/ml5@0.12.2/dist/ml5.min.js"></script>
</head>
<body>
<h1>PHANToM Room Trainer</h1>
<div class="container">
  <p>อัปโหลดภาพแต่ละหมวด เช่น LivingRoom / Kitchen / Bathroom / Balcony แล้วกด Train</p>
  <div>
    <input type="file" id="fileInput" multiple accept="image/*">
    <input type="text" id="labelInput" placeholder="ชื่อหมวด เช่น LivingRoom">
    <button id="addBtn">เพิ่มชุดภาพ</button>
  </div>
  <div>
    <button id="trainBtn">เริ่มเทรน</button>
    <button id="saveBtn">Export Model</button>
  </div>
  <div id="status">รอเพิ่มข้อมูล...</div>
</div>
<script>
let featureExtractor, classifier;
let added = 0;

window.onload = ()=>{
  featureExtractor = ml5.featureExtractor('MobileNet', ()=>{
    log('MobileNet Loaded ✓');
    classifier = featureExtractor.classification();
  });
}

document.getElementById('addBtn').onclick = ()=>{
  const files = document.getElementById('fileInput').files;
  const label = document.getElementById('labelInput').value.trim();
  if(!label || files.length===0){log('กรุณาเลือกไฟล์และกรอกชื่อหมวด');return;}
  for(let f of files){
    const img = new Image();
    img.src = URL.createObjectURL(f);
    img.onload = ()=>classifier.addImage(img,label);
  }
  added += files.length;
  log(`เพิ่มภาพ ${files.length} ภาพ เข้า label "${label}" แล้ว`);
}

document.getElementById('trainBtn').onclick = ()=>{
  log('กำลังเทรน...');
  classifier.train(loss=>{
    if(loss===null){log('✅ เทรนเสร็จสิ้น พร้อม Export');}
    else log('Loss: '+loss.toFixed(4));
  });
}

document.getElementById('saveBtn').onclick = ()=>{
  classifier.save();
  log('บันทึกโมเดลเรียบร้อย ✓');
}

function log(msg){document.getElementById('status').innerText=msg;}
</script>
</body>
</html>
