<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>PHANToM Image Sorter — AI + Condo/House</title>
  <style>
    :root{
      --bg:#0b1220; --panel:#0f1830; --edge:#243353; --txt:#e5e7eb; --muted:#9cb1d9;
      --pri:#6b8bff; --a1:#8bf5ff; --ok:#22c55e; --warn:#f59e0b; --err:#ef4444;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;background:radial-gradient(1000px 700px at 15% 15%,#101b3a,#070c18 60%);
          color:var(--txt);font-family:system-ui,Segoe UI,Roboto,"Prompt",sans-serif}
    header{display:flex;gap:12px;justify-content:space-between;align-items:center;padding:14px 16px;border-bottom:1px solid var(--edge);background:linear-gradient(180deg,rgba(255,255,255,.04),rgba(255,255,255,.02))}
    .brand{font-weight:800;letter-spacing:.4px}
    .brand small{display:block;color:var(--muted);font-weight:500}
    main{display:grid;grid-template-columns:340px 1fr;gap:12px;padding:12px}
    @media (max-width:980px){main{grid-template-columns:1fr}}
    .card{background:linear-gradient(180deg,rgba(255,255,255,.04),rgba(255,255,255,.02));border:1px solid var(--edge);border-radius:16px;box-shadow:0 8px 32px rgba(0,0,0,.25)}
    .left{padding:14px}
    .right{padding:10px}
    .droper{display:flex;flex-direction:column;align-items:center;justify-content:center;gap:10px;min-height:140px;border:2px dashed var(--edge);border-radius:14px;background:#0c1633; cursor:pointer}
    .droper.drag{border-color:var(--a1);box-shadow:0 0 0 3px rgba(139,245,255,.15)}
    input[type="file"]{display:none}
    .btns{display:flex;flex-wrap:wrap;gap:8px;margin-top:10px}
    button{appearance:none;border:1px solid transparent;border-radius:12px;padding:10px 12px;font-weight:700;cursor:pointer;background:var(--pri);color:white;transition:transform .05s ease, filter .2s ease}
    button:active{transform:translateY(1px)}
    button.secondary{background:#132044;border-color:var(--edge)}
    button.ghost{background:transparent;border-color:var(--edge);color:var(--txt)}
    button.warn{background:var(--warn);color:black}
    button.danger{background:var(--err)}
    button.ok{background:var(--ok)}
    .small{font-size:.9rem}
    .grid{--w:180px;display:grid;grid-template-columns:repeat(auto-fill,minmax(var(--w),1fr));gap:10px}
    .item{position:relative;border:1px solid var(--edge);border-radius:14px;overflow:hidden;background:#0e1a3a}
    .item.dragging{opacity:.7;outline:2px dashed var(--a1)}
    .thumb{aspect-ratio:1/1;display:block;width:100%;object-fit:cover}
    .bar{display:flex;align-items:center;justify-content:space-between;padding:8px;gap:8px;background:rgba(255,255,255,.03)}
    .idx{font-weight:800;font-size:.95rem;opacity:.9}
    .tags{display:flex;gap:6px;flex-wrap:wrap}
    .tag{font-size:.7rem;border:1px solid var(--edge);padding:3px 8px;border-radius:999px;color:var(--muted)}
    .cover{position:absolute;right:8px;top:8px;background:rgba(0,0,0,.45);border:1px solid var(--edge);padding:4px 6px;border-radius:10px;font-size:.75rem}
    .cover.active{background:linear-gradient(90deg,var(--pri),var(--a1));color:#001018}
    .delbtn{position:absolute;left:8px;top:8px;background:rgba(239,68,68,.9);border:0;padding:4px 7px;border-radius:9px;font-size:.75rem;color:#fff}
    .toast{position:fixed;right:14px;bottom:14px;background:#0d1b36;border:1px solid var(--edge);padding:10px 12px;border-radius:12px;opacity:0;transform:translateY(10px);pointer-events:none;transition:opacity .2s,transform .2s}
    .toast.show{opacity:1;transform:translateY(0)}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    .help{color:var(--muted);font-size:.92rem}
    .note{margin-top:8px;color:var(--muted)}
    .hl{color:var(--a1)}
    .kv{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
    .kv input[type="text"], .kv input[type="password"]{padding:8px 10px;border:1px solid var(--edge);border-radius:10px;background:#0e1a3a;color:var(--txt)}
    .radio{display:flex;gap:12px;align-items:center}
    .radio label{display:inline-flex;gap:6px;align-items:center;color:var(--muted)}
    .split{display:flex;gap:8px;flex-wrap:wrap}
    a.link{color:var(--a1);text-decoration:none;border:1px solid var(--edge);padding:8px 12px;border-radius:10px;background:#0d1733}
  </style>
</head>
<body>
  <header class="card">
    <div class="brand">PHANToM Image Sorter
      <small>AI Vision (Offline/Custom) + Drag & Drop + Export JPG/ZIP</small>
    </div>
    <div>by PHANToM</div>
  </header>

  <main>
    <section class="card left">
      <div class="split">
        <span class="help" id="aiStatus">Offline AI: ยังไม่โหลด</span>
        <span class="help" id="customStatus">Custom Model: ยังไม่โหลด</span>
        <a class="link" href="PHANToM_Room_Trainer.html">เทรนโมเดลใหม่</a>
      </div>

      <hr style="border:none;border-top:1px solid var(--edge);margin:10px 0"/>

      <label class="help">อัปโหลดรูปภาพ (รองรับ .jpg .png .webp)</label>
      <div id="drop" class="droper" title="คลิกเพื่อเลือกไฟล์ หรือ ลากรูปมาวาง">
        <div>ลากรูปมาวางที่นี่</div>
        <div class="small">หรือ คลิกเพื่อเลือกไฟล์…</div>
      </div>
      <input id="picker" type="file" accept="image/*" multiple />

      <div class="btns" style="margin-top:14px">
        <button id="autoHeu" class="ghost">Auto-sort (Heuristic)</button>
        <button id="autoAI" class="secondary" title="ใช้ Offline AI (MobileNetV2)">AI Sort (Offline)</button>
        <button id="autoCustom" class="secondary" title="โหลดโมเดลจาก Room Trainer (model.json + weights.bin)">AI Sort (Custom)</button>
        <button id="clear" class="warn">ล้างทั้งหมด</button>
      </div>

      <hr style="border:none;border-top:1px solid var(--edge);margin:12px 0"/>

      <div class="row">
        <div>
          <label class="help">คุณภาพ JPG (0.6–0.95)</label>
          <input id="quality" type="number" min="0.6" max="0.95" step="0.01" value="0.9" style="width:100%;padding:8px;border-radius:10px;border:1px solid var(--edge);background:#0e1a3a;color:var(--txt)">
        </div>
        <div>
          <label class="help">ภาพปก (เลือกได้สูงสุด 2 ภาพ)</label>
          <div class="help">กดปุ่ม “Cover” บนรูปเพื่อปักเป็นภาพ 1–2</div>
        </div>
      </div>

      <div class="btns">
        <button id="exportZip" class="ok">Export: JPG + Rename (ZIP)</button>
      </div>
    </section>

    <section class="card right">
      <div class="help" style="padding:6px 6px 10px">ลากสลับตำแหน่งรูปได้ด้วยนิ้ว/เมาส์ • แตะปุ่ม <b>Cover</b> เพื่อขึ้นปก • ปุ่ม <b>ลบ</b> อยู่ที่มุมซ้ายบนแต่ละรูป</div>
      <div id="grid" class="grid"></div>
    </section>
  </main>

  <div id="toast" class="toast">พร้อมทำงาน</div>

  <!-- libs -->
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.22.0/dist/tf.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/file-saver@2.0.5/dist/FileSaver.min.js"></script>

  <!-- app -->
  <script src="js/phantom-image-sorter.js"></script>
</body>
</html>
