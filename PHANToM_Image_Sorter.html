<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>PHANToM Image Sorter v3.1 — Dual AI + Export</title>
<style>
:root{
  --bg:#0a0f1f;--panel:#121a32;--edge:#1f2b46;
  --txt:#f1f4fb;--muted:#9bb1d8;
  --pri1:#6b8bff;--pri2:#8bf5ff;--pri3:#a76bff;
  --ok:#22c55e;--warn:#f59e0b;--err:#ef4444;
}
*{box-sizing:border-box;transition:all .25s ease}
html,body{height:100%}
body{
  margin:0;
  background:radial-gradient(circle at 10% 10%,#0f152c,#070c18 70%);
  font-family:"Prompt",system-ui,sans-serif;
  color:var(--txt);
}
header{
  display:flex;justify-content:space-between;align-items:center;
  padding:12px 16px;border-bottom:1px solid var(--edge);
  background:linear-gradient(90deg,#141d39,#10182f);
  box-shadow:0 4px 14px rgba(0,0,0,.3)
}
header .brand{font-weight:700;font-size:1.15rem}
header .brand small{display:block;font-size:.9rem;color:var(--muted)}
main{display:grid;grid-template-columns:340px 1fr;gap:14px;padding:12px}
@media(max-width:980px){main{grid-template-columns:1fr}}
.card{
  background:var(--panel);
  border:1px solid var(--edge);
  border-radius:16px;
  box-shadow:0 6px 22px rgba(0,0,0,.3);
  animation:fadeIn .6s ease;
}
.left{padding:16px;font-size:0.95rem}
.right{padding:10px}
.row{display:grid;grid-template-columns:1fr 1fr;gap:10px}
input,select{
  width:100%;padding:10px;border-radius:10px;
  background:#0e1835;border:1px solid var(--edge);color:var(--txt)
}
.droper{
  display:flex;flex-direction:column;align-items:center;justify-content:center;
  min-height:160px;border:2px dashed var(--edge);border-radius:14px;
  background:#0e1835;text-align:center;padding:14px;cursor:pointer;
  transition:border .25s, box-shadow .25s, transform .2s ease;
}
.droper.drag{border-color:var(--pri2);background:#102047;transform:scale(1.02)}
.btns{display:flex;flex-wrap:wrap;gap:10px;margin-top:14px}
button{
  position:relative;border:none;border-radius:10px;
  padding:10px 16px;font-weight:600;cursor:pointer;
  font-size:.95rem;color:#000;
  background:linear-gradient(90deg,var(--pri1),var(--pri3),var(--pri2));
  background-size:300% 300%;
  animation:aurora 8s infinite alternate ease-in-out;
  box-shadow:0 0 10px rgba(139,245,255,.25);
  overflow:hidden;
}
button::after{content:"";position:absolute;inset:0;background:rgba(255,255,255,.15);opacity:0}
button:hover::after{opacity:.25}
button:active{transform:scale(.97);filter:brightness(1.1)}
button.secondary{
  color:#fff;background:linear-gradient(90deg,#243b6b,#1b294f,#3c6aff);
  background-size:300% 300%;animation:aurora 6s infinite alternate;
}
button.ghost{
  background:transparent;color:var(--txt);
  border:1px solid var(--edge);box-shadow:none;
}
button.ghost:hover{border-color:var(--pri2);color:var(--pri2)}
button.warn{background:linear-gradient(90deg,#f59e0b,#facc15);color:#000}
button.ok{background:linear-gradient(90deg,#16a34a,#4ade80);color:#fff}
@keyframes aurora{0%{background-position:0% 50%}100%{background-position:100% 50%}}

.grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(160px,1fr));gap:12px}
.item{position:relative;border:1px solid var(--edge);border-radius:12px;overflow:hidden;background:#101b3a;cursor:grab}
.item.dragging{opacity:.7;outline:2px dashed var(--pri2)}
.thumb{aspect-ratio:1/1;width:100%;object-fit:cover;display:block}
.cover{position:absolute;right:6px;top:6px;background:rgba(0,0,0,.5);border:1px solid var(--edge);padding:4px 6px;border-radius:8px;font-size:.75rem;color:#e5e7eb;cursor:pointer}
.cover.active{background:linear-gradient(90deg,var(--pri1),var(--pri2));color:#001018;box-shadow:0 0 6px rgba(139,245,255,.6)}
.bar{display:flex;justify-content:space-between;align-items:center;padding:6px 8px;background:rgba(255,255,255,.05)}
.idx{font-weight:700;font-size:.9rem;opacity:.9}
.tag{font-size:.7rem;color:var(--muted)}

.toast{position:fixed;right:14px;bottom:14px;background:#0d1b36;border:1px solid var(--edge);padding:10px 12px;border-radius:12px;opacity:0;transform:translateY(10px);transition:opacity .25s,transform .25s;box-shadow:0 4px 20px rgba(0,0,0,.3)}
.toast.show{opacity:1;transform:translateY(0)}
.progress{height:10px;border-radius:999px;background:#0e1835;border:1px solid var(--edge);overflow:hidden}
.progress>span{display:block;height:100%;width:0;background:linear-gradient(90deg,var(--pri1),var(--pri2));transition:width .2s}
.status{font-size:.9rem;color:var(--muted)}

footer{text-align:center;margin:16px 0;color:var(--muted);font-size:.85rem;opacity:.8}
@keyframes fadeIn{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}
.ripple{position:absolute;width:80px;height:80px;background:rgba(255,255,255,.5);border-radius:50%;transform:scale(0);animation:rippleAnim .5s linear;pointer-events:none}
@keyframes rippleAnim{to{transform:scale(4);opacity:0}}
</style>
</head>
<body>
<header>
  <div class="brand">PHANToM Image Sorter <small>v3.1 · Offline AI + Export</small></div>
  <div>by PHANToM</div>
</header>

<main>
  <section class="card left">
    <div class="row">
      <div>
        <label class="status">Google Cloud Vision API Key (ใส่เฉพาะถ้ามี)</label>
        <input id="apiKey" type="password" placeholder="ใส่ API Key" />
      </div>
      <div>
        <label class="status">โหมดการเรียง</label>
        <select id="mode">
          <option value="condo" selected>คอนโด/ห้องเช่า</option>
          <option value="house">บ้าน</option>
        </select>
      </div>
    </div>

    <div class="row" style="margin-top:10px">
      <div>
        <label class="status">คุณภาพ JPG (0.6 – 0.95)</label>
        <input id="quality" type="number" min="0.6" max="0.95" step="0.01" value="0.90" />
      </div>
      <div>
        <label class="status">สถานะระบบ</label>
        <div id="sysStatus" class="status">Offline AI: <b>กำลังโหลด…</b></div>
      </div>
    </div>

    <hr style="border:none;border-top:1px solid var(--edge);margin:12px 0">

    <div id="dropZone" class="droper">
      <div>ลากรูปมาวางที่นี่</div>
      <div class="status" style="color:var(--pri2)">หรือ คลิกเพื่อเลือกไฟล์…</div>
    </div>

    <div class="btns">
      <button id="autoHeu" class="ghost">Auto-sort (Heuristic)</button>
      <button id="autoLocal" class="secondary">AI Sort (Offline)</button>
      <button id="autoAI" class="secondary">AI Sort (Google)</button>
      <button id="clear" class="warn">ล้างทั้งหมด</button>
    </div>

    <div style="margin-top:10px">
      <div class="progress"><span id="progressBar"></span></div>
      <div id="progressText" class="status" style="margin-top:6px">พร้อมทำงาน</div>
    </div>

    <div class="btns">
      <button id="exportZip" class="ok">Export : JPG + Rename (ZIP)</button>
    </div>

    <div class="status" style="margin-top:10px">
      หมายเหตุ: ปุ่ม <b>AI Sort (Google)</b> ใช้ได้เมื่อใส่ API Key และจะใช้งานจริงในรุ่นถัดไป
    </div>
  </section>

  <section class="card right">
    <div class="status" style="padding:8px">
      ลากเปลี่ยนลำดับได้ • แตะ “Cover” เพื่อเลือกปก (สูงสุด 2 รูป) • Export เป็น ZIP เรียงชื่อ <b>1.jpg…N.jpg</b>
    </div>
    <div id="grid" class="grid"></div>
  </section>
</main>

<footer>PHANToM Image Sorter v3.1 — by PHANToM</footer>
<div id="toast" class="toast">พร้อมทำงาน</div>

<!-- libs -->
<script src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/file-saver@2.0.5/dist/FileSaver.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@2.8.6"></script>
<script>
  // บังคับใช้ CPU backend แทน WebGL ถ้ามีปัญหา kernel
  tf.setBackend('cpu');
  tf.ready().then(() => console.log('[TFJS] Backend ready:', tf.getBackend()));
</script>
<script src="https://cdn.jsdelivr.net/npm/ml5@0.12.2/dist/ml5.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/ml5@0.12.2/dist/ml5.min.js"></script>

<!-- app -->
<script src="js/phantom-image-sorter.js"></script>

<script>
  // ripple effect for all buttons
  document.querySelectorAll('button').forEach(btn=>{
    btn.addEventListener('click',e=>{
      const circle=document.createElement('span');
      circle.classList.add('ripple');
      circle.style.left=e.offsetX+'px';
      circle.style.top=e.offsetY+'px';
      btn.appendChild(circle);
      setTimeout(()=>circle.remove(),500);
    });
  });
</script>
</body>
</html>
