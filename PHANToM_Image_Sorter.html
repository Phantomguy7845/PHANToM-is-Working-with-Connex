<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>PHANToM Image Sorter — v3.4 Stable</title>
  <style>
    :root{
      --bg:#0b1220; --panel:#111b34; --edge:#22345c; --txt:#e7ebf7;
      --muted:#9cb1d9; --pri:#6b8bff; --a1:#8bf5ff; --ok:#22c55e;
      --warn:#f59e0b; --err:#ef4444;
    }
    *{box-sizing:border-box;transition:all .2s ease}
    body{
      margin:0;background:radial-gradient(circle at 20% 20%,#131e3a,#070c18 60%);
      color:var(--txt);font-family:'Prompt',system-ui,sans-serif;
    }
    header{
      display:flex;justify-content:space-between;align-items:center;
      padding:14px 16px;border-bottom:1px solid var(--edge);
      background:linear-gradient(180deg,rgba(255,255,255,.05),rgba(255,255,255,.02));
    }
    .brand{font-weight:700;letter-spacing:.5px}
    .brand small{display:block;font-size:.8rem;color:var(--muted)}
    main{display:grid;grid-template-columns:340px 1fr;gap:12px;padding:14px;}
    @media(max-width:980px){main{grid-template-columns:1fr}}
    .card{background:rgba(255,255,255,.03);border:1px solid var(--edge);
      border-radius:16px;box-shadow:0 8px 24px rgba(0,0,0,.25);}
    .left{padding:16px;}
    .right{padding:12px;}
    .droper{
      display:flex;flex-direction:column;align-items:center;justify-content:center;
      gap:10px;min-height:130px;border:2px dashed var(--edge);border-radius:12px;
      background:#0e1833;text-align:center;color:var(--muted);
    }
    .droper.drag{border-color:var(--a1);color:var(--a1);background:#0c203a;}
    input[type="file"]{display:none;}
    button{
      cursor:pointer;border:none;border-radius:10px;padding:9px 14px;
      font-weight:600;font-size:.9rem;
    }
    .ok{background:var(--ok);color:#fff;}
    .warn{background:var(--warn);color:#000;}
    .ghost{background:#182647;border:1px solid var(--edge);color:var(--txt);}
    .ghost:hover{background:#22355c;}
    .secondary{background:var(--pri);}
    .btns{display:flex;flex-wrap:wrap;gap:8px;margin-top:10px;}
    .grid{--w:180px;display:grid;grid-template-columns:repeat(auto-fill,minmax(var(--w),1fr));gap:10px;}
    .item{position:relative;border:1px solid var(--edge);border-radius:10px;overflow:hidden;background:#0f1934;}
    .thumb{width:100%;aspect-ratio:1/1;object-fit:cover;display:block;}
    .cover{position:absolute;top:8px;right:8px;background:rgba(0,0,0,.5);
      padding:3px 6px;border-radius:8px;font-size:.75rem;cursor:pointer;}
    .cover.active{background:linear-gradient(90deg,var(--pri),var(--a1));color:#001018;font-weight:700;}
    .toast{
      position:fixed;bottom:14px;right:14px;padding:10px 14px;
      background:#0c1830;border:1px solid var(--edge);border-radius:12px;
      opacity:0;transform:translateY(10px);transition:.3s;pointer-events:none;
    }
    .toast.show{opacity:1;transform:translateY(0);}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:10px;}
    .help{color:var(--muted);font-size:.9rem;}
    .status{margin-top:6px;font-size:.85rem;}
    .status span.fail{color:var(--err);} .status span.ready{color:var(--ok);}
  </style>
</head>
<body>
  <header class="card">
    <div class="brand">PHANToM Image Sorter
      <small>v3.4 Stable • Offline AI + Export</small>
    </div>
    <div>by PHANToM</div>
  </header>

  <main>
    <section class="card left">
      <div class="help">Google Cloud Vision API Key (ใส่เฉพาะถ้ามี)</div>
      <input id="apiKey" type="password" placeholder="ใส่ API Key" style="width:100%;padding:8px;border-radius:10px;background:#0e1a3a;border:1px solid var(--edge);color:var(--txt)">
      <div class="status">สถานะระบบ <span id="aiStatus" class="fail">Offline AI: โหลดไม่สำเร็จ</span></div>

      <div style="margin-top:10px;">
        <label class="help">โหมดการเรียง:</label><br>
        <select id="mode" style="margin-top:4px;width:100%;padding:8px;border-radius:10px;background:#0e1a3a;color:#fff;border:1px solid var(--edge)">
          <option value="condo" selected>คอนโด/ห้องเช่า</option>
          <option value="house">บ้าน</option>
        </select>
      </div>

      <div style="margin-top:10px;">
        <label class="help">คุณภาพ JPG (0.6–0.95)</label>
        <input id="quality" type="number" min="0.6" max="0.95" step="0.01" value="0.9"
        style="width:100%;padding:8px;border-radius:10px;background:#0e1a3a;border:1px solid var(--edge);color:#fff">
      </div>

      <div class="droper" id="dropZone">
        <div>ลากรูปมาวางที่นี่</div>
        <div class="help small">หรือ คลิกเพื่อเลือกไฟล์…</div>
        <input type="file" id="filePicker" accept="image/*" multiple>
      </div>

      <div class="btns">
        <button id="btnHeuristic" class="ghost">Auto-sort (Heuristic)</button>
        <button id="btnAI" class="secondary">AI Sort (Offline)</button>
        <button id="btnClear" class="warn">ล้างทั้งหมด</button>
      </div>

      <hr style="border:none;border-top:1px solid var(--edge);margin:10px 0;">
      <button id="btnExport" class="ok" style="width:100%;">Export : JPG + Rename (ZIP)</button>
      <div class="help" style="margin-top:8px;">หมายเหตุ: Offline AI ใช้งานในเบราว์เซอร์โดยไม่ต้องใช้เซิร์ฟเวอร์</div>
    </section>

    <section class="card right">
      <div class="help" style="padding:8px;">ลากสลับตำแหน่งรูปได้ด้วยเมาส์/นิ้ว • แตะปุ่ม “Cover” เพื่อเลือกภาพหน้าปก (สูงสุด 2 รูป)</div>
      <div id="grid" class="grid"></div>
    </section>
  </main>

  <div id="toast" class="toast">พร้อมทำงาน</div>

  <!-- โหลด lib -->
  <script src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/file-saver@2.0.5/dist/FileSaver.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@1.7.4"></script>
  <script src="https://cdn.jsdelivr.net/npm/ml5@0.12.2/dist/ml5.min.js"></script>
  <script src="js/phantom-image-sorter.js"></script>
</body>
</html>
