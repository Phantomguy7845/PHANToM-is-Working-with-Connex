<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <title>PHANToM Runner</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    *{box-sizing:border-box;margin:0;padding:0;}

    :root{
      --bg1:#020617;
      --bg2:#020617;
      --accent:#f97316;
      --accent-soft:#fb923c;
      --accent-2:#22c55e;
      --accent-3:#38bdf8;
      --accent-4:#facc15;
      --danger:#ef4444;
      --panel-bg:rgba(15,23,42,0.92);
      --panel-soft:rgba(15,23,42,0.7);
      --border-soft:rgba(148,163,184,0.5);
      --text-main:#e5e7eb;
      --text-sub:#9ca3af;
      --glass:#ffffff;
    }

    body{
      font-family:system-ui,-apple-system,Segoe UI,Roboto,'Prompt',sans-serif;
      background:radial-gradient(circle at top,#0f172a,#020617);
      color:var(--text-main);
      min-height:100vh;
      display:flex;
      flex-direction:column;
      align-items:center;
      padding:16px 8px 32px;
      gap:10px;
    }

    h1{
      font-size:20px;
      letter-spacing:0.08em;
      text-transform:uppercase;
      text-align:center;
      color:#e5e7eb;
      text-shadow:0 0 18px rgba(248,250,252,0.18);
      margin-bottom:4px;
    }

    #topBar{
      width:100%;
      max-width:800px;
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:8px;
      padding:6px 10px;
      border-radius:999px;
      background:linear-gradient(135deg,rgba(15,23,42,0.95),rgba(15,23,42,0.75));
      border:1px solid rgba(148,163,184,0.45);
      box-shadow:0 16px 40px rgba(15,23,42,0.65);
      backdrop-filter:blur(18px);
    }

    #topBar-left{
      flex:1;
      display:flex;
      flex-direction:column;
      gap:3px;
    }

    .label-row{
      display:flex;
      justify-content:space-between;
      font-size:11px;
      color:var(--text-sub);
    }

    #energyBar{
      width:100%;
      height:14px;
      border-radius:999px;
      background:rgba(15,23,42,0.85);
      overflow:hidden;
      box-shadow:inset 0 0 0 1px rgba(15,23,42,1),
                 inset 0 0 12px rgba(15,23,42,0.9);
      position:relative;
    }

    #energyBarFill{
      width:100%;
      height:100%;
      border-radius:999px;
      background:linear-gradient(90deg,#22c55e,#eab308,#f97316,#ef4444);
      transform-origin:left center;
      transform:scaleX(1);
      transition:transform 0.18s linear;
      box-shadow:0 0 14px rgba(34,197,94,0.7);
    }

    #energyMarker{
      position:absolute;
      top:0;
      bottom:0;
      left:35%;
      width:2px;
      background:rgba(15,23,42,0.8);
      box-shadow:0 0 8px rgba(15,23,42,0.9);
    }

    #energyLabel{
      font-size:11px;
      color:var(--text-sub);
      margin-top:1px;
    }

    #topBar-right{
      display:flex;
      align-items:center;
      gap:8px;
      flex-shrink:0;
    }

    .miniStat{
      display:flex;
      align-items:center;
      gap:4px;
      padding:3px 7px;
      border-radius:999px;
      background:rgba(15,23,42,0.9);
      border:1px solid rgba(148,163,184,0.5);
      font-size:11px;
    }

    .miniStat span.icon{
      font-size:13px;
    }

    .miniStat span.value{
      min-width:40px;
      text-align:right;
      font-weight:600;
    }

    .chip{
      font-size:10px;
      padding:2px 6px;
      border-radius:999px;
      background:rgba(34,197,94,0.12);
      border:1px solid rgba(34,197,94,0.5);
      color:var(--accent-2);
    }

    /* GAME AREA */

    #gameContainer{
      position:relative;
      width:800px;
      max-width:95vw;
      height:260px; /* ‡∏Ñ‡∏á‡πÑ‡∏ß‡πâ ‡πÅ‡∏ï‡πà‡∏¢‡∏Å‡∏û‡∏∑‡πâ‡∏ô‡∏Ç‡∏∂‡πâ‡∏ô‡∏î‡πâ‡∏ß‡∏¢ JS */
      margin-top:10px;
      border-radius:18px;
      overflow:hidden;
      background:radial-gradient(circle at top,#111827,#020617);
      border:1px solid rgba(30,64,175,0.7);
      box-shadow:
        0 24px 60px rgba(15,23,42,0.9),
        inset 0 0 40px rgba(15,23,42,0.9);
      transform-origin:center;
    }

    #gameBg{
      position:absolute;
      inset:0;
      background:
        linear-gradient(#111827,#020617 60%,#000000 100%),
        url("https://i.imgur.com/N4X2bUo.png");
      background-size:cover;
      background-repeat:repeat-x;
      background-position:0 0;
      filter:brightness(1.08);
      z-index:0;
    }

    #ground{
      position:absolute;
      left:0;
      right:0;
      bottom:0;
      height:40px;
      background:
        linear-gradient(to top,#1e293b,#020617 60%),
        repeating-linear-gradient(
          90deg,
          rgba(15,23,42,0.8) 0 18px,
          rgba(0,0,0,0.85) 18px 20px
        );
      box-shadow:
        0 -8px 16px rgba(0,0,0,0.9),
        0 0 24px rgba(248,250,252,0.09) inset;
      z-index:1;
    }

    #player{
      position:absolute;
      width:46px;
      height:64px;
      background:radial-gradient(circle at 30% 20%,#facc15,#f97316 55%,#b91c1c 100%);
      border-radius:16px;
      box-shadow:
        0 0 18px rgba(248,250,252,0.2),
        0 18px 26px rgba(15,23,42,0.95);
      z-index:5;
      transform-origin:center bottom;
    }

    #player::before{
      content:"";
      position:absolute;
      left:8px;
      top:12px;
      width:30px;
      height:22px;
      border-radius:12px;
      background:radial-gradient(circle at 30% 30%,#fef9c3,#fed7aa 50%,#fb923c 100%);
      box-shadow:0 0 8px rgba(248,250,252,0.3);
    }

    #player::after{
      content:"";
      position:absolute;
      left:13px;
      bottom:7px;
      width:20px;
      height:28px;
      border-radius:999px;
      background:radial-gradient(circle at 30% 0%,#fed7aa,#f97316 60%,#c2410c 100%);
      box-shadow:0 0 10px rgba(251,146,60,0.6);
    }

    .collectible,.obstacle,.platform{
      position:absolute;
    }

    .coin{
      width:20px;
      height:20px;
      border-radius:999px;
      background:radial-gradient(circle at 30% 20%,#fef9c3,#facc15 55%,#b45309 100%);
      box-shadow:
        0 0 6px rgba(250,204,21,0.7),
        0 0 16px rgba(250,204,21,0.5);
      border:1px solid rgba(250,204,21,0.9);
      z-index:3;
    }

    .heart-small{
      width:18px;
      height:18px;
      background:
        radial-gradient(circle at 30% 20%,#f97316,#b91c1c 60%,#7f1d1d 100%);
      clip-path:path("M0.5 5.5C0.5 2.5 2.4 1 4.1 1c1.2 0 2.3 0.6 2.9 1.6C7.6 1.6 8.8 1 9.9 1 11.6 1 13.5 2.5 13.5 5.5c0 3.7-3.4 6.3-6.5 8.5-3.1-2.2-6.5-4.8-6.5-8.5z");
      box-shadow:0 0 10px rgba(248,113,113,0.7);
      z-index:3;
    }

    .heart-medium{
      width:22px;
      height:22px;
      background:
        radial-gradient(circle at 30% 20%,#fb7185,#e11d48 60%,#881337 100%);
      clip-path:path("M1 7C1 3.5 3.2 2 5.1 2c1.4 0 2.7.7 3.4 1.9C9.2 2.7 10.5 2 11.9 2 13.8 2 16 3.5 16 7c0 4.2-3.8 7.3-7.5 9.9C4.8 14.3 1 11.2 1 7z");
      box-shadow:0 0 12px rgba(251,113,133,0.9);
      z-index:3;
    }

    .heart-large{
      width:26px;
      height:26px;
      background:
        radial-gradient(circle at 30% 20%,#f97316,#f97316 40%,#b91c1c 75%,#450a0a 100%);
      clip-path:path("M1.2 8C1.2 4.2 3.8 2.5 6.1 2.5c1.7 0 3.2.9 4.0 2.3.8-1.4 2.3-2.3 4.0-2.3 2.3 0 4.9 1.7 4.9 5.5 0 5.1-4.5 8.8-8.9 11.9C5.7 16.7 1.2 13.1 1.2 8z");
      box-shadow:
        0 0 16px rgba(248,113,113,1),
        0 0 26px rgba(248,113,113,0.9);
      z-index:3;
    }

    .magnet{
      width:24px;
      height:24px;
      border-radius:6px;
      background:radial-gradient(circle at 30% 20%,#f97316,#b91c1c 60%,#450a0a 100%);
      box-shadow:0 0 16px rgba(248,113,113,0.8);
      position:absolute;
      z-index:3;
    }

    .magnet::before{
      content:"U";
      position:absolute;
      inset:0;
      display:flex;
      align-items:center;
      justify-content:center;
      font-weight:900;
      color:#fefce8;
      text-shadow:0 0 6px rgba(248,250,252,0.8);
    }

    .boost{
      width:26px;
      height:26px;
      border-radius:999px;
      background:radial-gradient(circle at 30% 20%,#f97316,#ea580c 55%,#7c2d12 100%);
      box-shadow:0 0 18px rgba(248,113,113,0.95);
      position:absolute;
      z-index:3;
    }

    .boost::before{
      content:"‚ö°";
      position:absolute;
      inset:0;
      display:flex;
      align-items:center;
      justify-content:center;
      font-size:18px;
    }

    .giant{
      width:26px;
      height:26px;
      border-radius:999px;
      background:radial-gradient(circle at 30% 20%,#38bdf8,#0ea5e9 55%,#0369a1 100%);
      box-shadow:0 0 18px rgba(56,189,248,0.95);
      position:absolute;
      z-index:3;
    }

    .giant::before{
      content:"‚¨§";
      position:absolute;
      inset:0;
      display:flex;
      align-items:center;
      justify-content:center;
      font-size:22px;
      color:#e0f2fe;
    }

    .platform{
      min-width:60px;
      height:18px;
      background:linear-gradient(to top,#1f2937,#0b1120);
      border-radius:6px;
      box-shadow:
        0 0 10px rgba(15,23,42,0.9),
        0 0 18px rgba(148,163,184,0.4) inset;
      z-index:2;
    }

    .obstacle{
      width:22px;
      height:32px;
      border-radius:6px 6px 0 0;
      background:linear-gradient(to top,#b91c1c,#7f1d1d);
      box-shadow:
        0 0 10px rgba(248,113,113,0.7),
        0 12px 18px rgba(15,23,42,0.9);
      z-index:4;
    }

    .obstacle.ceiling{
      height:28px;
      border-radius:0 0 6px 6px;
      background:linear-gradient(to bottom,#991b1b,#7f1d1d);
      box-shadow:0 0 16px rgba(248,113,113,0.9);
    }

    .hole{
      position:absolute;
      width:80px;
      border-radius:10px;
      background:radial-gradient(circle at 50% 0%,rgba(248,250,252,0.25),transparent 60%),
                  linear-gradient(to top,#020617,#0b1120);
      box-shadow:0 0 22px rgba(0,0,0,0.95);
      z-index:0;
    }

    .trap-lava{
      position:absolute;
      width:80px;
      height:20px;
      background:linear-gradient(to top,#991b1b,#f97316,#fde68a);
      box-shadow:
        0 0 20px rgba(248,113,113,0.9),
        0 0 32px rgba(248,113,113,0.9);
      border-radius:10px;
      z-index:0;
    }

    /* IN-GAME TOP BAR */

    #inGameTopBar{
      position:absolute;
      left:10px;
      right:10px;
      top:8px;
      z-index:12;
      display:flex;
      justify-content:space-between;
      align-items:center;
      pointer-events:none;
    }

    .ig-panel{
      display:flex;
      align-items:center;
      gap:6px;
      padding:4px 8px;
      border-radius:999px;
      background:rgba(15,23,42,0.9);
      border:1px solid rgba(148,163,184,0.6);
      box-shadow:0 8px 18px rgba(15,23,42,0.9);
      pointer-events:auto;
    }

    .ig-left{
      flex:0 0 auto;
      display:flex;
      align-items:center;
      gap:6px;
    }

    .ig-right{
      flex:0 0 auto;
      display:flex;
      align-items:center;
      gap:4px;
    }

    .ig-label{
      font-size:11px;
      color:var(--text-sub);
    }

    .ig-value{
      font-size:13px;
      font-weight:700;
      min-width:70px;
      text-align:right;
    }

    .ig-badge{
      font-size:10px;
      padding:2px 6px;
      border-radius:999px;
      background:rgba(248,250,252,0.06);
      border:1px solid rgba(148,163,184,0.7);
    }

    .icon-btn{
      width:30px;
      height:30px;
      border-radius:999px;
      border:1px solid rgba(148,163,184,0.65);
      background:radial-gradient(circle at 30% 0%,rgba(248,250,252,0.35),rgba(15,23,42,0.95));
      box-shadow:0 10px 20px rgba(15,23,42,0.9);
      display:flex;
      align-items:center;
      justify-content:center;
      font-size:14px;
      color:#e5e7eb;
      cursor:pointer;
      transition:transform 0.1s ease,box-shadow 0.1s ease,background 0.15s ease;
    }

    .icon-btn:hover{
      transform:translateY(-1px);
      box-shadow:0 14px 28px rgba(15,23,42,1);
    }

    .icon-btn:active{
      transform:translateY(1px) scale(0.96);
      box-shadow:0 6px 14px rgba(15,23,42,0.9);
    }

    .icon-btn.muted{
      background:radial-gradient(circle at 30% 0%,rgba(248,113,113,0.5),rgba(15,23,42,0.95));
    }

    /* TOUCH ZONES (‡∏ã‡∏µ‡∏Å‡∏ã‡πâ‡∏≤‡∏¢/‡∏Ç‡∏ß‡∏≤ ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏£‡∏∞‡πÇ‡∏î‡∏î/‡∏´‡∏°‡∏≠‡∏ö) */

    #touchZones{
      position:absolute;
      left:0;
      right:0;
      bottom:0;
      top:90px; /* ‡πÄ‡∏ß‡πâ‡∏ô‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô‡πÑ‡∏ß‡πâ‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏°‡∏ô‡∏π */
      z-index:4;
      pointer-events:auto;
    }

    .touch-zone{
      position:absolute;
      top:0;
      bottom:0;
      background:transparent;
    }

    #touchZoneLeft{
      left:0;
      right:50%;
    }

    #touchZoneRight{
      left:50%;
      right:0;
    }

    /* TOUCH CONTROLS ‚Äì ‡∏õ‡∏∏‡πà‡∏°‡πÅ‡∏Å‡πâ‡∏ß‡πÉ‡∏™ */

    #touchControls{
      position:absolute;
      left:0;
      right:0;
      bottom:10px;
      padding:0 16px;
      display:flex;
      justify-content:space-between;
      gap:14px;
      z-index:8;
      pointer-events:none; /* ‡πÉ‡∏´‡πâ‡πÇ‡∏ã‡∏ô‡πÉ‡∏´‡∏ç‡πà‡∏à‡∏±‡∏ö event ‡πÅ‡∏ï‡πà‡∏õ‡∏∏‡πà‡∏°‡∏¢‡∏±‡∏á‡∏Ñ‡∏•‡∏¥‡∏Å‡πÑ‡∏î‡πâ */
    }

    .ctrl-btn{
      pointer-events:auto;
      flex:1;
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:center;
      padding:6px 10px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,0.6);
      background:
        radial-gradient(circle at 30% 0%,rgba(255,255,255,0.9),rgba(255,255,255,0.18) 45%,rgba(148,163,184,0.05) 80%);
      box-shadow:
        0 10px 24px rgba(15,23,42,0.95),
        inset 0 0 0 0.5px rgba(255,255,255,0.55);
      backdrop-filter:blur(14px);
      color:var(--bg1);
      text-shadow:0 1px 2px rgba(255,255,255,0.8);
      cursor:pointer;
      position:relative;
      overflow:hidden;
      min-height:42px;
    }

    .ctrl-btn::before{
      content:"";
      position:absolute;
      inset:0;
      background:radial-gradient(circle at 20% 0%,rgba(255,255,255,0.85),transparent 60%);
      opacity:0.85;
      pointer-events:none;
    }

    .ctrl-btn .mainLabel{
      position:relative;
      font-size:14px;
      font-weight:700;
    }

    .ctrl-btn .sub{
      position:relative;
      font-size:11px;
      opacity:0.9;
    }

    .ctrl-btn:active{
      transform:translateY(1px) scale(0.97);
      box-shadow:0 6px 15px rgba(15,23,42,0.95);
    }

    /* OVERLAYS */

    .overlay{
      position:absolute;
      inset:0;
      background:radial-gradient(circle at top,#020617dd,#020617f0);
      display:flex;
      align-items:center;
      justify-content:center;
      z-index:30;
      opacity:0;
      pointer-events:none;
      transition:opacity 0.2s ease;
    }

    .overlay.active{
      opacity:1;
      pointer-events:auto;
    }

    .overlay-panel{
      width:90%;
      max-width:420px;
      padding:18px 16px 16px;
      border-radius:18px;
      background:var(--panel-bg);
      border:1px solid var(--border-soft);
      box-shadow:0 24px 60px rgba(15,23,42,1);
    }

    .overlay-panel h2{
      font-size:18px;
      margin-bottom:6px;
    }

    .overlay-panel p{
      font-size:13px;
      color:var(--text-sub);
      margin-bottom:10px;
    }

    .overlay-actions{
      display:flex;
      justify-content:flex-end;
      gap:8px;
      margin-top:10px;
    }

    .btn{
      padding:6px 14px;
      border-radius:999px;
      border:1px solid rgba(148,163,184,0.7);
      background:radial-gradient(circle at 30% 0%,rgba(248,250,252,0.2),rgba(15,23,42,0.98));
      color:var(--text-main);
      font-size:13px;
      cursor:pointer;
      display:inline-flex;
      align-items:center;
      gap:4px;
    }

    .btn.primary{
      border-color:rgba(249,115,22,0.9);
      background:radial-gradient(circle at 30% 0%,#fed7aa,#c2410c);
      color:#0b1120;
      font-weight:700;
    }

    .btn.primary:active{
      transform:translateY(1px) scale(0.97);
    }

    /* BOTTOM INFO */

    #cheatTimerRow{
      width:100%;
      max-width:800px;
      margin-top:6px;
      display:flex;
      justify-content:space-between;
      align-items:center;
      font-size:11px;
      color:var(--text-sub);
    }

    #missionBoard{
      width:100%;
      max-width:800px;
      margin-top:8px;
      padding:8px 10px;
      border-radius:12px;
      background:var(--panel-soft);
      border:1px solid var(--border-soft);
      box-shadow:0 14px 35px rgba(15,23,42,0.9);
      font-size:12px;
      line-height:1.45;
    }

    #missionBoard strong{
      color:#facc15;
    }

    #itemGuide{
      width:100%;
      max-width:800px;
      margin-top:8px;
      padding:8px 10px;
      border-radius:12px;
      background:var(--panel-soft);
      border:1px solid var(--border-soft);
      font-size:12px;
      line-height:1.45;
    }

    #hint{
      width:100%;
      max-width:800px;
      margin-top:6px;
      padding:6px 10px;
      border-radius:999px;
      background:rgba(22,163,74,0.13);
      border:1px dashed rgba(34,197,94,0.7);
      font-size:11px;
      color:#bbf7d0;
    }

    /* SHOP & SOUND MODAL (‡∏Ç‡∏≠‡∏á‡πÄ‡∏î‡∏¥‡∏°) */

    .modal{
      position:fixed;
      inset:0;
      background:rgba(15,23,42,0.85);
      display:flex;
      align-items:center;
      justify-content:center;
      z-index:40;
      opacity:0;
      pointer-events:none;
      transition:opacity 0.2s ease;
    }

    .modal.active{
      opacity:1;
      pointer-events:auto;
    }

    .modal-panel{
      width:92%;
      max-width:420px;
      max-height:80vh;
      padding:14px 14px 12px;
      border-radius:18px;
      background:var(--panel-bg);
      border:1px solid var(--border-soft);
      box-shadow:0 28px 60px rgba(15,23,42,1);
      display:flex;
      flex-direction:column;
      gap:8px;
    }

    .modal-header{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:8px;
      margin-bottom:4px;
    }

    .modal-title{
      font-size:16px;
      font-weight:600;
    }

    .modal-close{
      width:28px;
      height:28px;
      border-radius:999px;
      border:1px solid rgba(148,163,184,0.7);
      background:rgba(15,23,42,0.9);
      display:flex;
      align-items:center;
      justify-content:center;
      cursor:pointer;
    }

    #shopItems{
      flex:1;
      overflow:auto;
      padding-right:4px;
      display:flex;
      flex-direction:column;
      gap:8px;
      margin-top:4px;
    }

    .shop-item{
      display:flex;
      align-items:flex-start;
      gap:8px;
      padding:7px 8px;
      border-radius:12px;
      background:rgba(15,23,42,0.85);
      border:1px solid rgba(148,163,184,0.55);
    }

    .shop-item-icon{
      width:28px;
      height:28px;
      border-radius:999px;
      background:radial-gradient(circle at 30% 0%,#fed7aa,#f97316);
      display:flex;
      align-items:center;
      justify-content:center;
      font-size:17px;
      box-shadow:0 0 10px rgba(248,250,252,0.4);
      flex-shrink:0;
    }

    .shop-item-main{
      flex:1;
      display:flex;
      flex-direction:column;
      gap:2px;
      font-size:12px;
    }

    .shop-item-main strong{
      font-size:13px;
    }

    .shop-item-meta{
      display:flex;
      align-items:center;
      gap:6px;
      font-size:11px;
      color:var(--text-sub);
      margin-top:2px;
      flex-wrap:wrap;
    }

    .price-tag{
      padding:1px 6px;
      border-radius:999px;
      background:rgba(15,23,42,0.9);
      border:1px solid rgba(250,204,21,0.8);
      color:#facc15;
      font-weight:600;
    }

    .stock-tag{
      padding:1px 6px;
      border-radius:999px;
      border:1px solid rgba(148,163,184,0.6);
    }

    .shop-item button{
      padding:4px 8px;
      border-radius:999px;
      border:1px solid rgba(34,197,94,0.9);
      background:radial-gradient(circle at 30% 0%,rgba(74,222,128,0.35),rgba(15,23,42,1));
      color:#bbf7d0;
      font-size:12px;
      cursor:pointer;
    }

    .shop-item button:disabled{
      opacity:0.5;
      cursor:not-allowed;
    }

    #soundOptions{
      display:flex;
      flex-direction:column;
      gap:6px;
      font-size:12px;
    }

    .sound-row{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:8px;
    }

    .sound-row label{
      flex:1;
    }

    .sound-row input[type="range"]{
      width:130px;
    }

    .badge-xs{
      font-size:10px;
      padding:1px 5px;
      border-radius:999px;
      border:1px solid rgba(148,163,184,0.6);
      color:var(--text-sub);
    }

    @media (max-width:600px){
      #topBar{padding:6px 8px;}
      .miniStat span.value{min-width:32px;}
      #gameContainer{border-radius:16px;}
      .overlay-panel{padding:14px 12px;}
    }
  </style>
</head>
<body>
  <h1>PHANToM Runner</h1>

  <div id="topBar">
    <div id="topBar-left">
      <div class="label-row">
        <span>‡∏û‡∏•‡∏±‡∏á‡∏á‡∏≤‡∏ô (Energy)</span>
        <span id="energyText">100 / 100</span>
      </div>
      <div id="energyBar">
        <div id="energyBarFill"></div>
        <div id="energyMarker"></div>
      </div>
      <div id="energyLabel">‡∏û‡∏•‡∏±‡∏á‡∏á‡∏≤‡∏ô‡∏•‡∏î‡∏•‡∏á‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏Å‡∏° &amp; ‡∏ä‡∏ô‡∏™‡∏¥‡πà‡∏á‡∏Å‡∏µ‡∏î‡∏Ç‡∏ß‡∏≤‡∏á</div>
    </div>
    <div id="topBar-right">
      <div class="miniStat">
        <span class="icon">ü™ô</span>
        <span id="coinCount" class="value">0</span>
      </div>
      <div class="miniStat">
        <span class="icon">‚ù§Ô∏è</span>
        <span id="heartCount" class="value">0</span>
      </div>
      <div class="chip">‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç‡πÉ‡∏ô‡∏£‡πâ‡∏≤‡∏ô <span id="shopCoins">0</span></div>
    </div>
  </div>

  <div id="gameContainer">
    <div id="gameBg"></div>
    <div id="ground"></div>
    <div id="player"></div>

    <div id="inGameTopBar">
      <div class="ig-panel ig-left">
        <span class="ig-label">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</span>
        <span id="scoreDisplay" class="ig-value">0</span>
        <span class="ig-badge" id="statusBadge">Ready</span>
      </div>
      <div class="ig-right">
        <button id="helpBtn" class="icon-btn" title="‡∏Ñ‡∏π‡πà‡∏°‡∏∑‡∏≠ / ‡∏ß‡∏¥‡∏ò‡∏µ‡πÄ‡∏•‡πà‡∏ô">?</button>
        <button id="fullscreenBtn" class="icon-btn" title="‡πÇ‡∏´‡∏°‡∏î‡πÄ‡∏ï‡πá‡∏°‡∏à‡∏≠">‚õ∂</button>
        <button id="soundBtn" class="icon-btn" title="‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏™‡∏µ‡∏¢‡∏á">üéö</button>
        <button id="shopBtn" class="icon-btn" title="‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤">üõí</button>
        <button id="audioQuickBtn" class="icon-btn" title="‡πÄ‡∏õ‡∏¥‡∏î/‡∏õ‡∏¥‡∏î‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏´‡∏•‡∏±‡∏Å">üîä</button>
        <button id="pauseBtn" class="icon-btn" title="‡∏û‡∏±‡∏Å‡πÄ‡∏Å‡∏°">‚è∏</button>
      </div>
    </div>

    <!-- touch zones for half-screen control -->
    <div id="touchZones">
      <div id="touchZoneLeft" class="touch-zone"></div>
      <div id="touchZoneRight" class="touch-zone"></div>
    </div>

    <!-- glassy jump/slide buttons -->
    <div id="touchControls">
      <button id="btnJump" class="ctrl-btn">
        <span class="mainLabel">Jump</span>
        <span class="sub">‡∏Å‡∏£‡∏∞‡πÇ‡∏î‡∏î</span>
      </button>
      <button id="btnDuck" class="ctrl-btn">
        <span class="mainLabel">Slide</span>
        <span class="sub">‡∏´‡∏°‡∏≠‡∏ö</span>
      </button>
    </div>

    <!-- Overlays -->
    <div id="startOverlay" class="overlay active">
      <div class="overlay-panel">
        <h2>‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏•‡πà‡∏ô PHANToM Runner</h2>
        <p>
          ‡πÅ‡∏ï‡∏∞‡∏ó‡∏µ‡πà‡∏õ‡∏∏‡πà‡∏° <strong>Jump</strong> ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏£‡∏∞‡πÇ‡∏î‡∏î ‡∏´‡∏£‡∏∑‡∏≠ <strong>Slide</strong> ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏´‡∏°‡∏≠‡∏ö‡∏´‡∏•‡∏ö‡∏™‡∏¥‡πà‡∏á‡∏Å‡∏µ‡∏î‡∏Ç‡∏ß‡∏≤‡∏á<br>
          ‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç‡πÅ‡∏•‡∏∞‡∏´‡∏±‡∏ß‡πÉ‡∏à‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô ‡πÅ‡∏•‡∏∞‡πÉ‡∏ä‡πâ‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç‡∏ã‡∏∑‡πâ‡∏≠‡πÑ‡∏≠‡πÄ‡∏ó‡πá‡∏°‡πÉ‡∏ô‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤‡πÑ‡∏î‡πâ
        </p>
        <p style="font-size:11px;color:var(--text-sub);">
          ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏ö‡∏ô‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠: ‡πÅ‡∏ï‡∏∞‡∏ã‡∏µ‡∏Å‡∏ã‡πâ‡∏≤‡∏¢‡∏Ç‡∏≠‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡πÄ‡∏Å‡∏° = ‡∏Å‡∏£‡∏∞‡πÇ‡∏î‡∏î, ‡∏ã‡∏µ‡∏Å‡∏Ç‡∏ß‡∏≤ = ‡∏´‡∏°‡∏≠‡∏ö
        </p>
        <div class="overlay-actions">
          <button id="startButton" class="btn primary">‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°</button>
        </div>
      </div>
    </div>

    <div id="pauseOverlay" class="overlay">
      <div class="overlay-panel">
        <h2>‡∏û‡∏±‡∏Å‡πÄ‡∏Å‡∏°</h2>
        <p>‡πÄ‡∏Å‡∏°‡∏´‡∏¢‡∏∏‡∏î‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß ‡πÅ‡∏ï‡∏∞‡∏ï‡πà‡∏≠‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô‡∏ï‡πà‡∏≠ ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á</p>
        <div class="overlay-actions">
          <button id="resumeButton" class="btn">‡πÄ‡∏•‡πà‡∏ô‡∏ï‡πà‡∏≠</button>
          <button id="restartButton" class="btn primary">‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà</button>
        </div>
      </div>
    </div>

    <div id="resultOverlay" class="overlay">
      <div class="overlay-panel">
        <h2>‡∏à‡∏ö‡πÄ‡∏Å‡∏°</h2>
        <p id="resultSummary"></p>
        <div class="overlay-actions">
          <button id="restartResultButton" class="btn primary">‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà</button>
        </div>
      </div>
    </div>
  </div>

  <div id="cheatTimerRow">
    <span>Timer: <span id="debugTimer">0</span> ms</span>
    <button id="restartOutsideBtn" class="btn" style="padding-inline:10px;font-size:11px;">‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà‡∏î‡πà‡∏ß‡∏ô</button>
  </div>

  <div id="missionBoard">
    <strong>Mission:</strong>
    ‡∏ß‡∏¥‡πà‡∏á‡πÉ‡∏´‡πâ‡πÑ‡∏Å‡∏•‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î, ‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç/‡∏´‡∏±‡∏ß‡πÉ‡∏à ‡πÅ‡∏•‡∏∞‡∏•‡∏≠‡∏á‡πÉ‡∏ä‡πâ‡πÑ‡∏≠‡πÄ‡∏ó‡πá‡∏°‡∏à‡∏≤‡∏Å‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡∏£‡∏±‡∏ö‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡πà‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì
  </div>

  <div id="itemGuide">
    <strong>‡πÑ‡∏≠‡πÄ‡∏ó‡πá‡∏°‡∏´‡∏•‡∏±‡∏Å‡πÉ‡∏ô‡πÄ‡∏Å‡∏°</strong><br>
    ü™ô ‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç ‚Äì ‡πÉ‡∏ä‡πâ‡∏ã‡∏∑‡πâ‡∏≠‡πÑ‡∏≠‡πÄ‡∏ó‡πá‡∏°‡πÉ‡∏ô‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤<br>
    ‚ù§Ô∏è ‡∏´‡∏±‡∏ß‡πÉ‡∏à ‚Äì ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏û‡∏•‡∏±‡∏á‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï‡∏ï‡∏≤‡∏°‡∏Ç‡∏ô‡∏≤‡∏î‡∏´‡∏±‡∏ß‡πÉ‡∏à<br>
    üß≤ Magnet ‚Äì ‡∏î‡∏∂‡∏á‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç‡πÉ‡∏Å‡∏•‡πâ‡πÜ ‡πÄ‡∏Ç‡πâ‡∏≤‡∏°‡∏≤‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥<br>
    ‚ö° Boost ‚Äì ‡πÄ‡∏£‡πà‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß‡πÅ‡∏•‡∏∞‡∏Å‡∏±‡∏ô‡∏ä‡∏ô‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß<br>
    üîµ Giant ‚Äì ‡∏Ç‡∏¢‡∏≤‡∏¢‡∏ï‡∏±‡∏ß ‡∏•‡∏∏‡∏¢‡∏™‡∏¥‡πà‡∏á‡∏Å‡∏µ‡∏î‡∏Ç‡∏ß‡∏≤‡∏á‡πÑ‡∏î‡πâ‡∏ä‡πà‡∏ß‡∏á‡∏´‡∏ô‡∏∂‡πà‡∏á
  </div>

  <div id="hint">
    Hint: ‡πÅ‡∏ï‡∏∞‡∏ã‡∏µ‡∏Å‡∏ã‡πâ‡∏≤‡∏¢‡∏Ç‡∏≠‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡πÄ‡∏Å‡∏°‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏£‡∏∞‡πÇ‡∏î‡∏î, ‡∏ã‡∏µ‡∏Å‡∏Ç‡∏ß‡∏≤‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏´‡∏°‡∏≠‡∏ö (‡∏¢‡∏±‡∏á‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° Jump/Slide ‡πÑ‡∏î‡πâ‡∏ô‡∏∞)
  </div>

  <!-- ‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤ -->
  <div id="shopModal" class="modal">
    <div class="modal-panel">
      <div class="modal-header">
        <div>
          <div class="modal-title">‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤ PHANToM</div>
          <div style="font-size:11px;color:var(--text-sub);margin-top:2px;">
            ‡πÉ‡∏ä‡πâ‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡πà‡∏ô ‡∏ã‡∏∑‡πâ‡∏≠‡πÑ‡∏≠‡πÄ‡∏ó‡πá‡∏°‡πÄ‡∏™‡∏£‡∏¥‡∏°‡∏û‡∏•‡∏±‡∏á‡πÅ‡∏ö‡∏ö‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ 1 ‡πÄ‡∏Å‡∏°‡∏ï‡πà‡∏≠ 1 ‡∏ä‡∏¥‡πâ‡∏ô
          </div>
        </div>
        <button id="shopClose" class="modal-close">‚úï</button>
      </div>
      <div style="font-size:11px;color:var(--text-sub);">
        ‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô: <strong id="shopCoinsLabel">0</strong>
      </div>
      <div id="shopItems"></div>
    </div>
  </div>

  <!-- ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏™‡∏µ‡∏¢‡∏á -->
  <div id="soundModal" class="modal">
    <div class="modal-panel">
      <div class="modal-header">
        <div class="modal-title">‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏™‡∏µ‡∏¢‡∏á</div>
        <button id="soundClose" class="modal-close">‚úï</button>
      </div>
      <div id="soundOptions">
        <div class="sound-row">
          <label>‡∏£‡∏∞‡∏î‡∏±‡∏ö‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏´‡∏•‡∏±‡∏Å</label>
          <input id="masterVolume" type="range" min="0" max="1" step="0.05" />
          <span class="badge-xs" id="masterVolumeLabel">100%</span>
        </div>
        <div class="sound-row">
          <label>‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡πÄ‡∏≠‡∏ü‡πÄ‡∏ü‡∏Å‡∏ï‡πå</label>
          <input id="sfxVolume" type="range" min="0" max="1" step="0.05" />
          <span class="badge-xs" id="sfxVolumeLabel">100%</span>
        </div>
      </div>
    </div>
  </div>

  <!-- ‡∏Ñ‡∏π‡πà‡∏°‡∏∑‡∏≠ (popover ‡∏á‡πà‡∏≤‡∏¢‡πÜ) -->
  <div id="helpModal" class="modal">
    <div class="modal-panel">
      <div class="modal-header">
        <div class="modal-title">‡∏Ñ‡∏π‡πà‡∏°‡∏∑‡∏≠‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡πà‡∏ô</div>
        <button id="helpClose" class="modal-close">‚úï</button>
      </div>
      <div style="font-size:12px;line-height:1.5;">
        ‚Ä¢ ‡πÅ‡∏ï‡∏∞‡∏ã‡∏µ‡∏Å‡∏ã‡πâ‡∏≤‡∏¢‡∏Ç‡∏≠‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡πÄ‡∏Å‡∏° ‡∏´‡∏£‡∏∑‡∏≠‡∏õ‡∏∏‡πà‡∏° <strong>Jump</strong> ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏£‡∏∞‡πÇ‡∏î‡∏î<br>
        ‚Ä¢ ‡πÅ‡∏ï‡∏∞‡∏ã‡∏µ‡∏Å‡∏Ç‡∏ß‡∏≤‡∏Ç‡∏≠‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡πÄ‡∏Å‡∏° ‡∏´‡∏£‡∏∑‡∏≠‡∏õ‡∏∏‡πà‡∏° <strong>Slide</strong> ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏´‡∏°‡∏≠‡∏ö‡∏´‡∏•‡∏ö<br>
        ‚Ä¢ ‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç, ‡∏´‡∏±‡∏ß‡πÉ‡∏à ‡πÅ‡∏•‡∏∞‡πÑ‡∏≠‡πÄ‡∏ó‡πá‡∏°‡∏ï‡πà‡∏≤‡∏á‡πÜ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÅ‡∏•‡∏∞‡∏Ñ‡∏ß‡∏≤‡∏°‡∏≠‡∏¢‡∏π‡πà‡∏£‡∏≠‡∏î<br>
        ‚Ä¢ ‡πÑ‡∏≠‡πÄ‡∏ó‡πá‡∏°‡∏à‡∏≤‡∏Å‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡πÅ‡∏ö‡∏ö‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ <strong>1 ‡πÄ‡∏Å‡∏°‡∏ï‡πà‡∏≠ 1 ‡∏ä‡∏¥‡πâ‡∏ô</strong> (‡∏¢‡∏Å‡πÄ‡∏ß‡πâ‡∏ô Passive ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡πà‡∏°)<br>
        ‚Ä¢ Passive ‡∏à‡∏∞‡∏°‡∏µ‡∏ú‡∏•‡∏ó‡∏µ‡∏•‡∏∞ 1 ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ï‡πà‡∏≠‡πÄ‡∏Å‡∏° ‡∏ñ‡πâ‡∏≤‡∏ã‡∏∑‡πâ‡∏≠‡πÉ‡∏´‡∏°‡πà‡∏à‡∏∞‡∏™‡∏∏‡πà‡∏°‡∏ó‡∏±‡∏ö‡∏Ç‡∏≠‡∏á‡πÄ‡∏î‡∏¥‡∏°
      </div>
    </div>
  </div>

  <script>
    // ===== CONFIG (‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏Ñ‡∏¢‡πÅ‡∏Å‡πâ: heart gain / boost / giant / bg min ‡πÑ‡∏°‡πà‡πÅ‡∏ï‡∏∞) =====
    const CFG_INITIAL_ENERGY = 100;
    const CFG_RUN_BASE_SPEED = 3.2;
    const CFG_RUN_MAX_SPEED = 9.0;
    const CFG_SPEED_INCREMENT = 0.00035;

    const GROUND_THICKNESS = 40;
    const groundY = 100; // ‡∏¢‡∏Å‡∏û‡∏∑‡πâ‡∏ô‡∏Ç‡∏∂‡πâ‡∏ô (‡∏ï‡∏±‡∏ß‡∏•‡∏∞‡∏Ñ‡∏£‡∏à‡∏∞‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏Å‡∏•‡πâ‡∏Å‡∏•‡∏≤‡∏á‡∏à‡∏≠)
    const GROUND_BOTTOM = groundY - GROUND_THICKNESS;

    const gravity = -0.8;
    const jumpStrength = 15.5;
    const slideDuration = 460;

    const CFG_TRAP_Y = -60;

    // ‡∏Ñ‡πà‡∏≤ reward / ‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤ (‡∏ï‡∏≤‡∏°‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏î‡∏¥‡∏°‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì)
    const CFG_HEART_SMALL_GAIN = 3;
    const CFG_HEART_MEDIUM_GAIN = 8;
    const CFG_HEART_LARGE_GAIN = 36;

    const CFG_BOOST_DURATION = 5150;
    const CFG_GIANT_DURATION = 3800;

    const CFG_BG_SCROLL_MIN = 25500;
    const CFG_BG_SCROLL_MAX = 37500;

    // ===== DOM =====
    const gameContainer = document.getElementById('gameContainer');
    const gameBg = document.getElementById('gameBg');
    const ground = document.getElementById('ground');
    const playerEl = document.getElementById('player');

    const energyBarFill = document.getElementById('energyBarFill');
    const energyText = document.getElementById('energyText');
    const coinCountEl = document.getElementById('coinCount');
    const heartCountEl = document.getElementById('heartCount');
    const shopCoinsEl = document.getElementById('shopCoins');
    const shopCoinsLabel = document.getElementById('shopCoinsLabel');
    const scoreDisplay = document.getElementById('scoreDisplay');
    const statusBadge = document.getElementById('statusBadge');
    const debugTimerEl = document.getElementById('debugTimer');

    const startOverlay = document.getElementById('startOverlay');
    const pauseOverlay = document.getElementById('pauseOverlay');
    const resultOverlay = document.getElementById('resultOverlay');
    const resultSummary = document.getElementById('resultSummary');

    const startButton = document.getElementById('startButton');
    const resumeButton = document.getElementById('resumeButton');
    const restartButton = document.getElementById('restartButton');
    const restartResultButton = document.getElementById('restartResultButton');
    const restartOutsideBtn = document.getElementById('restartOutsideBtn');

    const btnJump = document.getElementById('btnJump');
    const btnDuck = document.getElementById('btnDuck');

    const touchZones = document.getElementById('touchZones');
    const touchZoneLeft = document.getElementById('touchZoneLeft');
    const touchZoneRight = document.getElementById('touchZoneRight');

    const fullscreenBtn = document.getElementById('fullscreenBtn');
    const soundBtn = document.getElementById('soundBtn');
    const shopBtn = document.getElementById('shopBtn');
    const audioQuickBtn = document.getElementById('audioQuickBtn');
    const pauseBtn = document.getElementById('pauseBtn');

    const shopModal = document.getElementById('shopModal');
    const shopClose = document.getElementById('shopClose');
    const shopItemsEl = document.getElementById('shopItems');

    const soundModal = document.getElementById('soundModal');
    const soundClose = document.getElementById('soundClose');
    const masterVolumeRange = document.getElementById('masterVolume');
    const sfxVolumeRange = document.getElementById('sfxVolume');
    const masterVolumeLabel = document.getElementById('masterVolumeLabel');
    const sfxVolumeLabel = document.getElementById('sfxVolumeLabel');

    const helpBtn = document.getElementById('helpBtn');
    const helpModal = document.getElementById('helpModal');
    const helpClose = document.getElementById('helpClose');

    // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ ground ‡∏ï‡∏≤‡∏°‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏á‡∏ó‡∏µ‡πà
    ground.style.bottom = GROUND_BOTTOM + "px";
    ground.style.height = GROUND_THICKNESS + "px";

    // ===== GAME STATE =====
    let energy = CFG_INITIAL_ENERGY;
    let score = 0;
    let coins = 0;
    let hearts = 0;
    let shopCoins = 0;

    let playerX = 120;
    let playerY = groundY;
    let playerVX = 0;
    let playerVY = 0;

    let isJumping = false;
    let isSliding = false;
    let slideTimer = 0;

    let gameRunning = false;
    let isPaused = false;
    let lastFrameTime = 0;
    let speed = CFG_RUN_BASE_SPEED;

    let objects = []; // obstacles / coins / hearts / items / holes / platforms
    let magnetActive = false;
    let magnetTimer = 0;
    let boostActive = false;
    let boostTimer = 0;
    let giantActive = false;
    let giantTimer = 0;

    let hitIFramesTimer = 0;
    const CFG_HIT_IFRAMES = 2500; // 2.5 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ ‡∏Å‡∏±‡∏ô‡∏ä‡∏ô + ‡∏Å‡∏£‡∏∞‡∏û‡∏£‡∏¥‡∏ö‡∏ä‡πâ‡∏≤

    // spawn timers (‡πÇ‡∏Ñ‡πâ‡∏î‡πÄ‡∏î‡∏¥‡∏°‡πÅ‡∏ö‡∏ö‡∏¢‡πà‡∏≠)
    let timeSinceLastCoin = 0;
    let timeSinceLastHeart = 0;
    let timeSinceLastObstacle = 0;
    let timeSinceLastItem = 0;
    let timeSinceLastBgScroll = 0;

    const CFG_COIN_INTERVAL = 220;
    const CFG_HEART_BASE_INTERVAL = 2600;
    const CFG_HEART_MIN_INTERVAL = 1300;
    const CFG_OBS_INTERVAL = 850;
    const CFG_ITEM_INTERVAL = 6800;

    // Passive / shop
    let passive = null;
    const PASSIVES = {
      DOUBLE_COINS: 'DOUBLE_COINS',
      LESS_ENERGY: 'LESS_ENERGY',
      FREE_REVIVE: 'FREE_REVIVE',
      HOLE_PROTECT: 'HOLE_PROTECT'
    };

    let usedFreeReviveThisRun = false;

    // ‡πÑ‡∏≠‡πÄ‡∏ó‡πá‡∏°‡πÉ‡∏ô‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà (‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ 1 ‡πÄ‡∏Å‡∏°‡∏ï‡πà‡∏≠ 1 ‡∏ä‡∏¥‡πâ‡∏ô ‡∏™‡∏∞‡∏™‡∏°‡πÑ‡∏î‡πâ)
    const shopState = {
      startEnergyBoost: 0, // +50 ‡∏ï‡πà‡∏≠‡∏ä‡∏¥‡πâ‡∏ô
      startInstantBoost: 0, // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°‡∏°‡∏µ boost ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
      passiveBox: 0 // ‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏™‡∏∏‡πà‡∏° passive
    };

    // ===== UTILS =====
    function rand(min,max){return Math.random()*(max-min)+min;}
    function randInt(min,max){return Math.floor(Math.random()*(max-min+1))+min;}

    function clamp(v,min,max){return v<min?min:(v>max?max:v);}

    // ===== UI UPDATE =====
    function updateEnergyUI(){
      const ratio = clamp(energy/CFG_INITIAL_ENERGY,0,1);
      energyBarFill.style.transform = `scaleX(${ratio})`;
      energyText.textContent = `${Math.round(energy)} / ${CFG_INITIAL_ENERGY}`;
    }

    function updateTopStats(){
      coinCountEl.textContent = coins;
      heartCountEl.textContent = hearts;
      shopCoinsEl.textContent = shopCoins;
      shopCoinsLabel.textContent = shopCoins;
      scoreDisplay.textContent = Math.round(score);
    }

    function setStatus(text,color){
      statusBadge.textContent = text;
      statusBadge.style.color = color || '#e5e7eb';
    }

    function showOverlay(el){
      startOverlay.classList.remove('active');
      pauseOverlay.classList.remove('active');
      resultOverlay.classList.remove('active');
      if(el) el.classList.add('active');
    }

    function hideAllOverlays(){
      startOverlay.classList.remove('active');
      pauseOverlay.classList.remove('active');
      resultOverlay.classList.remove('active');
    }

    // ===== OBJECT HELPERS =====
    let objIdCounter = 1;
    function makeObj(type,props){
      const el = document.createElement('div');
      el.dataset.type = type;
      el.dataset.id = objIdCounter++;
      el.classList.add(type);
      gameContainer.appendChild(el);
      const obj = Object.assign({
        id: el.dataset.id,
        type,
        el,
        x: props.x||0,
        y: props.y||0,
        w: props.w||24,
        h: props.h||24,
        speedMultiplier:1
      },props||{});
      objects.push(obj);
      return obj;
    }

    function removeObj(obj){
      if(!obj) return;
      if(obj.el && obj.el.parentNode) obj.el.parentNode.removeChild(obj.el);
      objects = objects.filter(o=>o!==obj);
    }

    // ===== SPAWNERS =====
    function spawnCoinRow(){
      const baseX = gameContainer.clientWidth + 40;
      const laneBottom = groundY + 40;
      const count = randInt(5,11);
      for(let i=0;i<count;i++){
        makeObj('coin',{
          x: baseX + i*26,
          y: laneBottom + randInt(-6,6),
          w:20,h:20
        });
      }
    }

    function spawnHeartSmallOrMedium(){
      const baseX = gameContainer.clientWidth + 40;
      const lane = randInt(0,2);
      const y = groundY + 60 + lane*40;
      // ‡πÇ‡∏≠‡∏Å‡∏≤‡∏™‡∏≠‡∏≠‡∏Å‡∏´‡∏±‡∏ß‡πÉ‡∏à‡∏Å‡∏•‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢‡∏Å‡∏ß‡πà‡∏≤
      const isMedium = Math.random() < 0.22;
      makeObj(isMedium?'heart-medium':'heart-small',{
        x: baseX,
        y,
        w: isMedium?22:18,
        h: isMedium?22:18
      });
    }

    function spawnObstacle(){
      const baseX = gameContainer.clientWidth + 40;
      const type = Math.random()<0.5?'ground':'ceiling';
      if(type==='ground'){
        makeObj('obstacle',{
          x:baseX,
          y:groundY,
          w:22,h:32
        });
      }else{
        makeObj('obstacle',{
          x:baseX,
          y:groundY+80,
          w:22,h:32,
          ceiling:true,
          elClass:'ceiling'
        });
      }
    }

    function spawnItem(){
      const baseX = gameContainer.clientWidth + 40;
      const choices = ['magnet','boost','giant','heart-large'];
      const pick = choices[randInt(0,choices.length-1)];
      const y = groundY + randInt(60,120);
      makeObj(pick,{
        x:baseX,y,
        w:26,h:26
      });
    }

    function spawnHole(){
      const baseX = gameContainer.clientWidth + 60;
      const width = randInt(70,110);
      const hole = makeObj('hole',{
        x:baseX,
        y:GROUND_BOTTOM,
        w:width,h:GROUND_THICKNESS
      });
      const lava = makeObj('trap-lava',{
        x:baseX,
        y:GROUND_BOTTOM-20,
        w:width,
        h:20
      });
      hole.lava = lava;
    }

    // ===== PLAYER CONTROL =====
    function handleJumpPress(){
      if(!gameRunning || isPaused) return;
      if(!isJumping){
        isJumping = true;
        playerVY = jumpStrength;
      }
    }

    function handleJumpRelease(){
      // optional early fall; ‡∏Ç‡∏ì‡∏∞‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡∏ó‡∏≥‡∏≠‡∏∞‡πÑ‡∏£‡πÄ‡∏õ‡πá‡∏ô‡∏û‡∏¥‡πÄ‡∏®‡∏©
    }

    function handleSlidePress(){
      if(!gameRunning || isPaused) return;
      if(!isSliding){
        isSliding = true;
        slideTimer = slideDuration;
        playerEl.style.transform = 'scaleY(0.7)';
      }
    }

    function handleSlideRelease(){
      // slide ‡∏à‡∏∞‡∏´‡∏°‡∏î‡∏ï‡∏≤‡∏°‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏≠‡∏á
    }

    // touch zone events
    function bindTouchZone(zone, onDown, onUp){
      ['pointerdown','touchstart'].forEach(evt=>{
        zone.addEventListener(evt,e=>{
          e.preventDefault();
          if(!gameRunning || isPaused) return;
          onDown();
        });
      });
      ['pointerup','pointercancel','pointerleave','touchend','touchcancel'].forEach(evt=>{
        zone.addEventListener(evt,e=>{
          e.preventDefault();
          if(!gameRunning || isPaused) return;
          onUp();
        });
      });
    }

    bindTouchZone(touchZoneLeft, handleJumpPress, handleJumpRelease);
    bindTouchZone(touchZoneRight, handleSlidePress, handleSlideRelease);

    // ‡∏õ‡∏∏‡πà‡∏°‡∏à‡∏£‡∏¥‡∏á
    btnJump.addEventListener('pointerdown',e=>{e.preventDefault();handleJumpPress();});
    btnDuck.addEventListener('pointerdown',e=>{e.preventDefault();handleSlidePress();});
    btnJump.addEventListener('pointerup',e=>{e.preventDefault();handleJumpRelease();});
    btnDuck.addEventListener('pointerup',e=>{e.preventDefault();handleSlideRelease();});

    // keyboard
    window.addEventListener('keydown',e=>{
      if(e.code==='Space' || e.code==='ArrowUp' || e.code==='KeyW') handleJumpPress();
      if(e.code==='ArrowDown' || e.code==='KeyS') handleSlidePress();
      if(e.code==='Escape') togglePause();
    });
    window.addEventListener('keyup',e=>{
      if(e.code==='ArrowDown' || e.code==='KeyS') handleSlideRelease();
    });

    // ===== GAME LOOP =====
    function resetGameState(){
      energy = CFG_INITIAL_ENERGY + shopState.startEnergyBoost*50;
      score = 0;
      coins = 0;
      hearts = 0;
      usedFreeReviveThisRun = false;

      // ‡πÉ‡∏ä‡πâ boost ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ
      if(shopState.startInstantBoost>0){
        boostActive = true;
        boostTimer = CFG_BOOST_DURATION;
        shopState.startInstantBoost--;
      }else{
        boostActive = false;
        boostTimer = 0;
      }

      magnetActive = false;
      magnetTimer = 0;
      giantActive = false;
      giantTimer = 0;
      hitIFramesTimer = 0;

      speed = CFG_RUN_BASE_SPEED;
      playerX = 120;
      playerY = groundY;
      playerVY = 0;
      isJumping = false;
      isSliding = false;
      slideTimer = 0;
      playerEl.style.transform = 'scale(1)';
      playerEl.style.opacity = '1';

      // ‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå object ‡πÄ‡∏î‡∏¥‡∏°
      objects.forEach(o=>o.el.remove());
      objects = [];

      timeSinceLastCoin = 0;
      timeSinceLastHeart = 0;
      timeSinceLastObstacle = 0;
      timeSinceLastItem = 0;
      timeSinceLastBgScroll = 0;

      updateEnergyUI();
      updateTopStats();
      setStatus('Ready','#e5e7eb');
    }

    function startGame(){
      resetGameState();
      hideAllOverlays();
      gameRunning = true;
      isPaused = false;
      lastFrameTime = performance.now();
      requestAnimationFrame(gameLoop);
    }

    function endGame(reason){
      gameRunning = false;
      isPaused = false;

      // ‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç‡∏ö‡∏≤‡∏á‡∏™‡πà‡∏ß‡∏ô‡πÄ‡∏õ‡πá‡∏ô shopCoins
      const gainedShopCoins = Math.round(coins * (passive===PASSIVES.DOUBLE_COINS?0.7:0.5));
      shopCoins += gainedShopCoins;

      let msg = `‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô ${Math.round(score)}\n‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡πá‡∏ö‡πÑ‡∏î‡πâ: ${coins}\n‡∏´‡∏±‡∏ß‡πÉ‡∏à‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ: ${hearts}\n‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡πÇ‡∏ï‡∏£‡πå: ${gainedShopCoins}`;
      if(reason) msg = reason + "\n\n" + msg;
      resultSummary.textContent = msg;

      updateTopStats();
      showOverlay(resultOverlay);
      setStatus('Game Over', '#f87171');
    }

    function tryReviveIfPossible(reason){
      if(passive===PASSIVES.FREE_REVIVE && !usedFreeReviveThisRun){
        usedFreeReviveThisRun = true;
        energy = CFG_INITIAL_ENERGY*0.5;
        hitIFramesTimer = 1500;
        playerY = groundY+20;
        playerVY = 0;
        isJumping = false;
        isSliding = false;
        playerEl.style.opacity = '0.5';
        setStatus('Free Revive!', '#facc15');
        return;
      }
      endGame(reason);
    }

    function applyHit(){
      if(hitIFramesTimer>0) return;
      energy -= 18;
      if(energy<=0){
        tryReviveIfPossible('‡∏û‡∏•‡∏±‡∏á‡∏á‡∏≤‡∏ô‡∏´‡∏°‡∏î');
        return;
      }
      hitIFramesTimer = CFG_HIT_IFRAMES;
      playerEl.style.opacity = '0.45';
      setStatus('‡πÇ‡∏î‡∏ô‡∏ä‡∏ô!', '#f97316');
    }

    function updatePlayer(dt){
      // physics
      playerVY += gravity;
      playerY += playerVY;

      // slide
      if(isSliding){
        slideTimer -= dt;
        if(slideTimer<=0){
          isSliding = false;
          playerEl.style.transform = 'scale(1)';
        }
      }

      // ground support & hole check
      let supportY = groundY;
      let holeUnder = false;
      for(const obj of objects){
        if(obj.type==='hole'){
          const pLeft = playerX-16;
          const pRight = playerX+16;
          const oLeft = obj.x;
          const oRight = obj.x + obj.w;
          if(pRight>oLeft && pLeft<oRight){
            holeUnder = true;
          }
        }
        if(obj.type==='platform'){
          const pLeft = playerX-16;
          const pRight = playerX+16;
          const oLeft = obj.x;
          const oRight = obj.x + obj.w;
          if(pRight>oLeft && pLeft<oRight){
            if(playerY>=obj.y && playerY<=obj.y+40){
              supportY = Math.max(supportY, obj.y);
            }
          }
        }
      }

      if(playerY <= supportY){
        if(!(supportY===groundY && holeUnder)){
          playerY = supportY;
          playerVY = 0;
          isJumping = false;
        }
      }

      // ‡∏ï‡∏Å‡∏´‡∏•‡∏∏‡∏°‡∏•‡∏∂‡∏Å
      if(playerY < CFG_TRAP_Y){
        if(passive===PASSIVES.HOLE_PROTECT){
          // ‡∏Å‡∏±‡∏ô‡∏ï‡∏Å‡∏´‡∏•‡∏∏‡∏° 1 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏ö‡∏ö‡∏ô‡∏¥‡πà‡∏° ‡πÜ
          passive = null;
          playerY = groundY + 20;
          playerVY = 0;
          setStatus('Hole Shield!', '#38bdf8');
        }else{
          tryReviveIfPossible('‡∏ï‡∏Å‡∏´‡∏•‡∏∏‡∏°');
          return;
        }
      }

      // update DOM
      playerEl.style.left = playerX + 'px';
      playerEl.style.bottom = playerY + 'px';

      // iFrames blink
      if(hitIFramesTimer>0){
        hitIFramesTimer -= dt;
        const t = hitIFramesTimer;
        const blink = Math.cos(t/150) > 0 ? 0.35 : 0.9; // ‡∏Å‡∏£‡∏∞‡∏û‡∏£‡∏¥‡∏ö‡∏ä‡πâ‡∏≤‡∏•‡∏á
        playerEl.style.opacity = blink;
        if(hitIFramesTimer<=0){
          playerEl.style.opacity = '1';
          setStatus('Running','#4ade80');
        }
      }
    }

    function updateObjects(dt){
      const baseSpeed = speed * (boostActive?1.85:1);
      const magnetRange = magnetActive ? 150 : 0;

      for(const obj of [...objects]){
        const vx = -baseSpeed*(obj.speedMultiplier||1);
        obj.x += vx;

        // magnet for coins/hearts
        if(magnetRange>0 && (obj.type==='coin' || obj.type.startsWith('heart'))){
          const dx = obj.x - playerX;
          const dy = obj.y - playerY;
          const dist = Math.hypot(dx,dy);
          if(dist<magnetRange){
            obj.x += -dx * 0.12;
            obj.y += -dy * 0.12;
          }
        }

        // remove off screen
        if(obj.x < -200){
          removeObj(obj);
          continue;
        }

        obj.el.style.left = obj.x + 'px';
        obj.el.style.bottom = obj.y + 'px';

        // collision
        if(obj.type==='coin' || obj.type.startsWith('heart') || obj.type==='magnet' || obj.type==='boost' || obj.type==='giant'){
          const pLeft = playerX-16;
          const pRight = playerX+16;
          const pBottom = playerY;
          const pTop = playerY + (isSliding?42:64);
          const oLeft = obj.x;
          const oRight = obj.x + obj.w;
          const oBottom = obj.y;
          const oTop = obj.y + obj.h;
          if(pRight>oLeft && pLeft<oRight && pTop>oBottom && pBottom<oTop){
            if(obj.type==='coin'){
              coins += passive===PASSIVES.DOUBLE_COINS ? 2 : 1;
            }else if(obj.type==='heart-small'){
              hearts += CFG_HEART_SMALL_GAIN;
              energy = clamp(energy+CFG_HEART_SMALL_GAIN,0,CFG_INITIAL_ENERGY);
            }else if(obj.type==='heart-medium'){
              hearts += CFG_HEART_MEDIUM_GAIN;
              energy = clamp(energy+CFG_HEART_MEDIUM_GAIN,0,CFG_INITIAL_ENERGY);
            }else if(obj.type==='heart-large'){
              hearts += CFG_HEART_LARGE_GAIN;
              energy = clamp(energy+CFG_HEART_LARGE_GAIN,0,CFG_INITIAL_ENERGY);
            }else if(obj.type==='magnet'){
              magnetActive = true;
              magnetTimer = 6500;
              setStatus('Magnet!', '#38bdf8');
            }else if(obj.type==='boost'){
              boostActive = true;
              boostTimer = CFG_BOOST_DURATION;
              setStatus('Boost!!', '#f97316');
            }else if(obj.type==='giant'){
              giantActive = true;
              giantTimer = CFG_GIANT_DURATION;
              setStatus('Giant!!','#38bdf8');
            }
            removeObj(obj);
            updateEnergyUI();
            updateTopStats();
          }
        }else if(obj.type==='obstacle'){
          const pLeft = playerX-16;
          const pRight = playerX+16;
          const pBottom = playerY;
          const pTop = playerY + (isSliding?42:64);
          const oLeft = obj.x;
          const oRight = obj.x + obj.w;
          const oBottom = obj.y;
          const oTop = obj.y + obj.h;
          if(pRight>oLeft && pLeft<oRight && pTop>oBottom && pBottom<oTop){
            if(giantActive || boostActive){
              removeObj(obj);
            }else{
              applyHit();
            }
          }
        }
      }
    }

    function updateItemsTimers(dt){
      if(magnetActive){
        magnetTimer -= dt;
        if(magnetTimer<=0){
          magnetActive = false;
        }
      }
      if(boostActive){
        boostTimer -= dt;
        if(boostTimer<=0){
          boostActive = false;
          setStatus('Running','#4ade80');
        }
      }
      if(giantActive){
        giantTimer -= dt;
        if(giantTimer<=0){
          giantActive = false;
          setStatus('Running','#4ade80');
        }
      }
    }

    function updateSpawners(dt){
      timeSinceLastCoin += dt;
      timeSinceLastHeart += dt;
      timeSinceLastObstacle += dt;
      timeSinceLastItem += dt;
      timeSinceLastBgScroll += dt;

      if(timeSinceLastCoin >= CFG_COIN_INTERVAL){
        spawnCoinRow();
        timeSinceLastCoin = 0;
      }

      const heartInterval = Math.max(CFG_HEART_MIN_INTERVAL, CFG_HEART_BASE_INTERVAL - Math.floor(score/6)*12);
      if(timeSinceLastHeart >= heartInterval){
        spawnHeartSmallOrMedium();
        timeSinceLastHeart = 0;
      }

      if(timeSinceLastObstacle >= CFG_OBS_INTERVAL){
        if(Math.random()<0.2){
          spawnHole();
        }else{
          spawnObstacle();
        }
        timeSinceLastObstacle = 0;
      }

      if(timeSinceLastItem >= CFG_ITEM_INTERVAL){
        spawnItem();
        timeSinceLastItem = 0;
      }

      if(timeSinceLastBgScroll >= rand(CFG_BG_SCROLL_MIN,CFG_BG_SCROLL_MAX)){
        timeSinceLastBgScroll = 0;
      }
    }

    function gameLoop(now){
      if(!gameRunning) return;
      const dt = now - lastFrameTime;
      lastFrameTime = now;
      debugTimerEl.textContent = Math.round(dt);

      if(isPaused){
        requestAnimationFrame(gameLoop);
        return;
      }

      const energyDrainBase = passive===PASSIVES.LESS_ENERGY ? 0.007 : 0.01;
      energy -= energyDrainBase * dt/16 * (boostActive?0.7:1);
      if(energy<=0){
        tryReviveIfPossible('‡∏û‡∏•‡∏±‡∏á‡∏á‡∏≤‡∏ô‡∏´‡∏°‡∏î');
        return;
      }

      speed = Math.min(CFG_RUN_MAX_SPEED, speed + CFG_SPEED_INCREMENT*dt);
      score += speed * dt * 0.08;

      updatePlayer(dt);
      updateObjects(dt);
      updateItemsTimers(dt);
      updateSpawners(dt);

      updateEnergyUI();
      updateTopStats();

      requestAnimationFrame(gameLoop);
    }

    function togglePause(){
      if(!gameRunning) return;
      if(isPaused){
        isPaused = false;
        hideAllOverlays();
        lastFrameTime = performance.now();
        requestAnimationFrame(gameLoop);
      }else{
        isPaused = true;
        showOverlay(pauseOverlay);
      }
    }

    // ===== SHOP LOGIC (‡πÅ‡∏ö‡∏ö‡∏¢‡πà‡∏≠ ‡∏ï‡∏≤‡∏°‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡πÉ‡∏´‡∏°‡πà) =====
    const SHOP_DEF = [
      {
        id:'startEnergy',
        label:'‡πÄ‡∏û‡∏¥‡πà‡∏° Energy ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô +50',
        icon:'‚ö°',
        price:25,
        desc:'‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏û‡∏•‡∏±‡∏á‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏à‡∏≤‡∏Å 100 ‡πÄ‡∏õ‡πá‡∏ô 150 / 200 / ... ‡∏ï‡πà‡∏≠‡∏ä‡∏¥‡πâ‡∏ô (‡∏°‡∏µ‡∏ú‡∏•‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÄ‡∏Å‡∏°‡∏ñ‡∏±‡∏î‡πÑ‡∏õ)',
        apply:()=>{shopState.startEnergyBoost++;},
        getStockText:()=>`‡∏™‡∏∞‡∏™‡∏°‡πÅ‡∏•‡πâ‡∏ß: ${shopState.startEnergyBoost} ‡∏ä‡∏¥‡πâ‡∏ô`
      },
      {
        id:'instantBoost',
        label:'Boost ‡∏ï‡∏≠‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏° 5 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ',
        icon:'üöÄ',
        price:30,
        desc:'‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°‡∏û‡∏£‡πâ‡∏≠‡∏° Boost ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ (‡πÄ‡∏£‡πà‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß + ‡∏Å‡∏±‡∏ô‡∏ä‡∏ô‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß)',
        apply:()=>{shopState.startInstantBoost++;},
        getStockText:()=>`‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ: ${shopState.startInstantBoost} ‡πÄ‡∏Å‡∏°`
      },
      {
        id:'passiveBox',
        label:'‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏™‡∏∏‡πà‡∏° Passive ‡∏û‡∏¥‡πÄ‡∏®‡∏©',
        icon:'üéÅ',
        price:40,
        desc:'‡∏™‡∏∏‡πà‡∏° Passive 1 ‡∏≠‡∏¢‡πà‡∏≤‡∏á (‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç x2 / ‡πÉ‡∏ä‡πâ Energy ‡∏ô‡πâ‡∏≠‡∏¢‡∏•‡∏á / ‡∏ä‡∏∏‡∏ö‡∏ü‡∏£‡∏µ 1 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á / ‡∏Å‡∏±‡∏ô‡∏ï‡∏Å‡∏´‡∏•‡∏∏‡∏°)',
        apply:()=>{
          shopState.passiveBox++;
          rollPassive();
        },
        getStockText:()=>`‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡∏¥‡∏î‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß: ${shopState.passiveBox}`
      }
    ];

    function rollPassive(){
      const all = [PASSIVES.DOUBLE_COINS,PASSIVES.LESS_ENERGY,PASSIVES.FREE_REVIVE,PASSIVES.HOLE_PROTECT];
      const pick = all[randInt(0,all.length-1)];
      if(pick===passive){
        // ‡πÑ‡∏î‡πâ‡∏ã‡πâ‡∏≥ ‡∏•‡∏î‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ã‡∏∑‡πâ‡∏≠‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ñ‡∏±‡∏î‡πÑ‡∏õ 15% (‡∏à‡∏≥‡∏•‡∏≠‡∏á: ‡πÉ‡∏´‡πâ shopCoins +5 ‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏≤‡∏£‡∏Ñ‡∏∑‡∏ô‡∏ó‡∏∏‡∏ô‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢)
        shopCoins += 5;
        setStatus('Passive ‡πÄ‡∏î‡∏¥‡∏° ‚Äì ‡∏£‡∏±‡∏ö‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç‡∏Ñ‡∏∑‡∏ô‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢','#facc15');
      }
      passive = pick;
    }

    function buildShopUI(){
      shopItemsEl.innerHTML = '';
      SHOP_DEF.forEach(item=>{
        const row = document.createElement('div');
        row.className = 'shop-item';
        row.innerHTML = `
          <div class="shop-item-icon">${item.icon}</div>
          <div class="shop-item-main">
            <strong>${item.label}</strong>
            <div>${item.desc}</div>
            <div class="shop-item-meta">
              <span class="price-tag">ü™ô ${item.price}</span>
              <span class="stock-tag">${item.getStockText()}</span>
            </div>
          </div>
          <div>
            <button>‡∏ã‡∏∑‡πâ‡∏≠</button>
          </div>
        `;
        const btn = row.querySelector('button');
        btn.disabled = shopCoins < item.price;
        btn.addEventListener('click',()=>{
          if(shopCoins < item.price) return;
          shopCoins -= item.price;
          item.apply();
          updateTopStats();
          buildShopUI();
        });
        shopItemsEl.appendChild(row);
      });
    }

    // ===== SOUND (dummy ‚Äì ‡πÄ‡∏â‡∏û‡∏≤‡∏∞ UI) =====
    let masterVolume = 1;
    let sfxVolume = 1;

    function setMasterVolume(v){
      masterVolume = v;
      masterVolumeLabel.textContent = Math.round(v*100)+'%';
    }
    function setSfxVolume(v){
      sfxVolume = v;
      sfxVolumeLabel.textContent = Math.round(v*100)+'%';
    }

    masterVolumeRange.value = masterVolume;
    sfxVolumeRange.value = sfxVolume;
    setMasterVolume(masterVolume);
    setSfxVolume(sfxVolume);

    masterVolumeRange.addEventListener('input',()=>setMasterVolume(parseFloat(masterVolumeRange.value||'0')));
    sfxVolumeRange.addEventListener('input',()=>setSfxVolume(parseFloat(sfxVolumeRange.value||'0')));

    audioQuickBtn.addEventListener('click',()=>{
      if(masterVolume>0){
        setMasterVolume(0);
        masterVolumeRange.value = 0;
        audioQuickBtn.classList.add('muted');
      }else{
        setMasterVolume(1);
        masterVolumeRange.value = 1;
        audioQuickBtn.classList.remove('muted');
      }
    });

    // ===== FULLSCREEN =====
    fullscreenBtn.addEventListener('click',()=>{
      if(!document.fullscreenElement){
        document.documentElement.requestFullscreen?.();
      }else{
        document.exitFullscreen?.();
      }
    });

    // ===== MODAL HANDLERS =====
    shopBtn.addEventListener('click',()=>{
      buildShopUI();
      shopModal.classList.add('active');
    });
    shopClose.addEventListener('click',()=>shopModal.classList.remove('active'));

    soundBtn.addEventListener('click',()=>soundModal.classList.add('active'));
    soundClose.addEventListener('click',()=>soundModal.classList.remove('active'));

    helpBtn.addEventListener('click',()=>helpModal.classList.add('active'));
    helpClose.addEventListener('click',()=>helpModal.classList.remove('active'));

    // ===== BUTTON HANDLERS =====
    startButton.addEventListener('click',startGame);
    resumeButton.addEventListener('click',togglePause);
    pauseBtn.addEventListener('click',togglePause);
    restartButton.addEventListener('click',()=>{resetGameState();hideAllOverlays();startGame();});
    restartResultButton.addEventListener('click',()=>{resetGameState();hideAllOverlays();startGame();});
    restartOutsideBtn.addEventListener('click',()=>{resetGameState();hideAllOverlays();startGame();});

    // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ó‡∏µ‡πà‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°
    updateEnergyUI();
    updateTopStats();
    showOverlay(startOverlay);
  </script>
</body>
</html>
