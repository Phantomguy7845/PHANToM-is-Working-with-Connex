<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <title>PHANToM Runner</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      background: #020617;
      color: #e5e7eb;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding-top: 40px;
    }

    h1 {
      margin-bottom: 8px;
      letter-spacing: 0.08em;
      text-transform: uppercase;
    }

    #hint {
      font-size: 13px;
      color: #9ca3af;
      margin-bottom: 12px;
      text-align: center;
    }

    #gameContainer {
      position: relative;
      width: 800px;
      max-width: 95vw;
      height: 260px;
      border: 2px solid #4b5563;
      overflow: hidden;
      border-radius: 16px;
      background: radial-gradient(circle at top, #1d2337 0, #020617 55%, #020617 100%);
      box-shadow: 0 20px 40px rgba(15, 23, 42, 0.9);
    }

    #ground {
      position: absolute;
      bottom: 0;
      left: 0;
      width: 200%;
      height: 40px;
      background: repeating-linear-gradient(
        -45deg,
        #6b7280 0,
        #6b7280 12px,
        #4b5563 12px,
        #4b5563 24px
      );
      animation: groundMove 1s linear infinite;
      opacity: 0.9;
    }

    @keyframes groundMove {
      from { transform: translateX(0); }
      to   { transform: translateX(-50%); }
    }

    /* ==== ‡∏ï‡∏±‡∏ß‡∏•‡∏∞‡∏Ñ‡∏£‡πÉ‡∏ä‡πâ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û ==== */
    #player {
      position: absolute;
      bottom: 40px;
      left: 80px;
      width: 70px;
      height: 70px;
      transform-origin: center bottom;
      transition: transform 0.08s ease, box-shadow 0.15s ease;
      box-shadow: 0 0 20px rgba(56, 189, 248, 0.85);
    }

    #player img {
      width: 100%;
      height: 100%;
      object-fit: contain;
      pointer-events: none;
      user-select: none;
      filter: drop-shadow(0 0 10px rgba(15,23,42,0.9));
    }

    /* ‡∏´‡∏°‡∏≠‡∏ö */
    #player.duck {
      transform: translateY(-8px) scaleY(0.7);
      box-shadow: 0 0 14px rgba(56, 189, 248, 0.9);
    }

    /* ‡∏≠‡∏°‡∏ï‡∏∞ */
    #player.invincible {
      box-shadow:
        0 0 26px rgba(250, 204, 21, 1),
        0 0 70px rgba(250, 204, 21, 0.7);
    }

    .obstacle {
      position: absolute;
      bottom: 40px;
      border-radius: 6px;
      box-shadow: 0 0 16px rgba(15, 23, 42, 0.9);
    }

    .obstacle.ground.tree {
      background: linear-gradient(to top, #166534, #4ade80);
      border-radius: 4px 4px 0 0;
    }

    .obstacle.ground.bush {
      background: linear-gradient(to top, #15803d, #22c55e);
      border-radius: 16px;
    }

    .obstacle.ground.rock {
      background: radial-gradient(circle at 30% 20%, #e5e7eb, #9ca3af);
      border-radius: 40% 60% 30% 70%;
    }

    .obstacle.air.bird {
      background: radial-gradient(circle at 30% 30%, #fef3c7, #f97316);
      border-radius: 50%;
    }

    #scoreBoard {
      margin-top: 14px;
      font-size: 15px;
      display: flex;
      gap: 16px;
    }

    #cheatTimer {
      margin-top: 4px;
      font-size: 14px;
      min-height: 20px;
      color: #facc15;
      text-shadow: 0 0 8px rgba(250, 204, 21, 0.9);
    }

    #message {
      margin-top: 6px;
      font-size: 13px;
      color: #9ca3af;
      text-align: center;
      max-width: 800px;
    }

    #startBtn {
      margin-top: 14px;
      padding: 8px 22px;
      border: none;
      border-radius: 999px;
      font-size: 14px;
      cursor: pointer;
      background: linear-gradient(to right, #22c55e, #2dd4bf);
      color: #022c22;
      font-weight: 600;
      box-shadow: 0 10px 25px rgba(34, 197, 94, 0.35);
      transition: transform 0.08s ease, box-shadow 0.08s ease, filter 0.08s;
    }

    #startBtn:hover {
      transform: translateY(-1px);
      box-shadow: 0 14px 32px rgba(34, 197, 94, 0.55);
      filter: brightness(1.05);
    }

    #startBtn:active {
      transform: translateY(1px);
      box-shadow: 0 6px 16px rgba(34, 197, 94, 0.4);
      filter: brightness(0.98);
    }

    @media (max-width: 600px) {
      #gameContainer { height: 230px; }
      #player { left: 40px; }
    }
  </style>
</head>
<body>
  <h1>PHANToM Runner</h1>
  <div id="hint">
    Space / ‚Üë = ‡∏Å‡∏£‡∏∞‡πÇ‡∏î‡∏î ‚Ä¢ ‚Üì = ‡∏´‡∏°‡∏≠‡∏ö 
  </div>

  <div id="gameContainer">
    <div id="ground"></div>
    <div id="player">
      <!-- ‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏ü‡∏•‡πå‡∏£‡∏π‡∏õ ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÑ‡∏î‡πâ‡∏ï‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏ï‡∏±‡πâ‡∏á -->
      <img src="phantom-runner.png" alt="PHANToM" />
    </div>
  </div>

  <div id="scoreBoard">
    <div id="score">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô: 0</div>
    <div id="bestScore">‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î: 0</div>
  </div>
  <div id="cheatTimer"></div>
  <div id="message">‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° "‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏° / ‡πÄ‡∏•‡πà‡∏ô‡πÉ‡∏´‡∏°‡πà" ‡∏´‡∏£‡∏∑‡∏≠‡∏Å‡∏î Space ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°</div>
  <button id="startBtn">‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏° / ‡πÄ‡∏•‡πà‡∏ô‡πÉ‡∏´‡∏°‡πà</button>

  <script>
    (function () {
      const gameContainer = document.getElementById("gameContainer");
      const player = document.getElementById("player");
      const scoreEl = document.getElementById("score");
      const bestScoreEl = document.getElementById("bestScore");
      const messageEl = document.getElementById("message");
      const startBtn = document.getElementById("startBtn");
      const cheatTimerEl = document.getElementById("cheatTimer");

      const groundY = 40;

      // ‡∏ü‡∏¥‡∏™‡∏¥‡∏Å‡∏™‡πå‡∏Å‡∏£‡∏∞‡πÇ‡∏î‡∏î
      let isJumping = false;
      let jumpVelocity = 0;
      const gravity = 0.6;
      const jumpStrength = 11;
      let playerY = groundY;

      // ‡∏´‡∏°‡∏≠‡∏ö
      let isDucking = false;

      // ‡πÄ‡∏Å‡∏°
      let obstacles = [];
      let speed = 6;
      let score = 0;
      let bestScore = Number(localStorage.getItem("phantom_runner_best") || 0);
      bestScoreEl.textContent = "‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î: " + bestScore;

      let gameOver = false;
      let frameId = null;
      let lastTime = null;

      let timeSinceLastObstacle = 0;
      let nextSpawnIn = 1000;

      // ‡πÇ‡∏´‡∏°‡∏î‡πÇ‡∏Å‡∏á
      let invincible = false;
      let invincibleTimer = 0;
      const INVINCIBLE_DURATION = 10000; // 10 ‡∏ß‡∏¥

      // ‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö‡∏™‡∏π‡∏ï‡∏£‡πÇ‡∏Å‡∏á
      const CHEAT_WINDOW = 1000; // 1 ‡∏ß‡∏¥
      let cheatEvents = []; // {symbol: 'D'|'U', time}

      function randomBetween(min, max) {
        return Math.random() * (max - min) + min;
      }

      function resetGame() {
        obstacles.forEach(o => o.remove());
        obstacles = [];

        score = 0;
        speed = 6;
        scoreEl.textContent = "‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô: 0";
        gameOver = false;

        isJumping = false;
        isDucking = false;
        playerY = groundY;
        player.style.bottom = playerY + "px";
        player.classList.remove("duck", "invincible");

        invincible = false;
        invincibleTimer = 0;
        cheatEvents = [];
        cheatTimerEl.textContent = "";

        timeSinceLastObstacle = 0;
        nextSpawnIn = 800 + Math.random() * 600;

        messageEl.textContent = "‡∏´‡∏•‡∏ö‡∏ï‡πâ‡∏ô‡πÑ‡∏°‡πâ/‡∏Å‡πâ‡∏≠‡∏ô‡∏´‡∏¥‡∏ô (‡∏Å‡∏£‡∏∞‡πÇ‡∏î‡∏î) ‡πÅ‡∏•‡∏∞‡∏ô‡∏Å (‡∏´‡∏°‡∏≠‡∏ö) ‡πÉ‡∏´‡πâ‡πÑ‡∏î‡πâ‡∏ô‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î!";

        if (frameId) cancelAnimationFrame(frameId);
        lastTime = null;
        frameId = requestAnimationFrame(gameLoop);

        spawnObstacle();
      }

      function spawnObstacle() {
        const obs = document.createElement("div");
        obs.classList.add("obstacle");

        const isAir = Math.random() < 0.35; // 35% ‡πÄ‡∏õ‡πá‡∏ô‡∏ô‡∏Å

        if (isAir) {
          obs.classList.add("air", "bird");
          const height = randomBetween(24, 32);
          const width = randomBetween(34, 40);
          obs.style.width = width + "px";
          obs.style.height = height + "px";
          const bottom = randomBetween(95, 125);
          obs.style.bottom = bottom + "px";
        } else {
          obs.classList.add("ground");
          const types = ["tree", "bush", "rock"];
          const kind = types[Math.floor(Math.random() * types.length)];
          obs.classList.add(kind);

          const height = randomBetween(45, 80);
          const width = randomBetween(22, 40);
          obs.style.width = width + "px";
          obs.style.height = height + "px";
          obs.style.bottom = groundY + "px";
        }

        obs.style.left = gameContainer.offsetWidth + "px";
        gameContainer.appendChild(obs);
        obstacles.push(obs);
      }

      function updateObstacles(delta) {
        const moveX = speed * (delta / 16.67);
        const toRemove = [];

        obstacles.forEach((obs, index) => {
          const left = parseFloat(obs.style.left);
          const newLeft = left - moveX;
          obs.style.left = newLeft + "px";

          if (newLeft + obs.offsetWidth < 0) {
            toRemove.push(index);
            score += 1;
            scoreEl.textContent = "‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô: " + score;

            if (score % 5 === 0) {
              speed += 0.5;
            }
          }

          if (!gameOver && !invincible && isColliding(player, obs)) {
            endGame();
          }
        });

        toRemove.reverse().forEach(i => {
          obstacles[i].remove();
          obstacles.splice(i, 1);
        });

        timeSinceLastObstacle += delta;

        const minInterval = Math.max(550, 1000 - score * 5);
        const maxInterval = Math.max(minInterval + 300, 1600 - score * 8);

        if (timeSinceLastObstacle >= nextSpawnIn) {
          let canSpawn = true;
          if (obstacles.length > 0) {
            const lastObs = obstacles[obstacles.length - 1];
            const lastRect = lastObs.getBoundingClientRect();
            const containerRect = gameContainer.getBoundingClientRect();
            const distance = containerRect.right - lastRect.right;
            if (distance < 180) {
              canSpawn = false;
            }
          }

          if (canSpawn) {
            spawnObstacle();
            timeSinceLastObstacle = 0;
            nextSpawnIn = randomBetween(minInterval, maxInterval);
          } else {
            timeSinceLastObstacle = minInterval - 50;
          }
        }
      }

      function isColliding(a, b) {
        const r1 = a.getBoundingClientRect();
        const r2 = b.getBoundingClientRect();
        return !(
          r1.right < r2.left ||
          r1.left > r2.right ||
          r1.bottom < r2.top ||
          r1.top > r2.bottom
        );
      }

      function updatePlayer(delta) {
        const factor = delta / 16.67;
        if (isJumping) {
          playerY += jumpVelocity * factor;
          jumpVelocity -= gravity * factor;

          if (playerY <= groundY) {
            playerY = groundY;
            isJumping = false;
            jumpVelocity = 0;
          }
          player.style.bottom = playerY + "px";
        }
      }

      function gameLoop(timestamp) {
        if (gameOver) return;
        if (!lastTime) lastTime = timestamp;
        const delta = timestamp - lastTime;
        lastTime = timestamp;

        updatePlayer(delta);
        updateObstacles(delta);

        if (invincible) {
          invincibleTimer -= delta;
          if (invincibleTimer <= 0) {
            invincible = false;
            player.classList.remove("invincible");
            cheatTimerEl.textContent = "";
            messageEl.textContent = "‡πÇ‡∏´‡∏°‡∏î‡πÇ‡∏Å‡∏á‡∏´‡∏°‡∏î‡πÅ‡∏•‡πâ‡∏ß! ‡∏£‡∏∞‡∏ß‡∏±‡∏á‡πÉ‡∏´‡πâ‡∏î‡∏µ üòà";
          } else {
            if (invincibleTimer <= 3000) {
              const secs = Math.ceil(invincibleTimer / 1000);
              cheatTimerEl.textContent = "‡∏ô‡∏±‡∏ö‡∏ñ‡∏≠‡∏¢‡∏´‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏°‡∏î‡πÇ‡∏Å‡∏á: " + secs + " ‡∏ß‡∏¥";
            } else {
              cheatTimerEl.textContent = "‡πÇ‡∏´‡∏°‡∏î‡πÇ‡∏Å‡∏á: PHANToM ‡∏≠‡∏°‡∏ï‡∏∞‡∏≠‡∏¢‡∏π‡πà ‚ú®";
            }
          }
        }

        frameId = requestAnimationFrame(gameLoop);
      }

      function endGame() {
        gameOver = true;
        if (frameId) cancelAnimationFrame(frameId);

        if (score > bestScore) {
          bestScore = score;
          localStorage.setItem("phantom_runner_best", bestScore);
        }
        bestScoreEl.textContent = "‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î: " + bestScore;

        cheatTimerEl.textContent = "";
        messageEl.textContent =
          "Game Over! ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô: " +
          score +
          ' ‚Ä¢ ‡∏Å‡∏î "‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏° / ‡πÄ‡∏•‡πà‡∏ô‡πÉ‡∏´‡∏°‡πà" ‡∏´‡∏£‡∏∑‡∏≠ Space ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà';
      }

      function handleJump() {
        if (gameOver) {
          resetGame();
          return;
        }
        if (!isJumping) {
          isJumping = true;
          jumpVelocity = jumpStrength;
        }
      }

      function setDuck(state) {
        if (gameOver) return;
        if (state && !isDucking) {
          isDucking = true;
          player.classList.add("duck");
        } else if (!state && isDucking) {
          isDucking = false;
          player.classList.remove("duck");
        }
      }

      // ‚Üì‚Üì‚Üì ‡∏™‡∏π‡∏ï‡∏£‡πÇ‡∏Å‡∏á: DDD UUU (U = ‚Üë ‡∏´‡∏£‡∏∑‡∏≠ Space)
      function registerCheat(code) {
        const now = performance.now();
        if (code !== "ArrowDown" && code !== "ArrowUp" && code !== "Space") return;

        const symbol = (code === "ArrowDown") ? "D" : "U";
        cheatEvents.push({ symbol, time: now });

        const cutoff = now - CHEAT_WINDOW;
        cheatEvents = cheatEvents.filter(e => e.time >= cutoff);

        const lastSix = cheatEvents.slice(-6);
        if (lastSix.length === 6) {
          const pattern = lastSix.map(e => e.symbol).join("");
          if (pattern === "DDDUUU" && !invincible && !gameOver) {
            activateCheat();
            cheatEvents = [];
          }
        }
      }

      function activateCheat() {
        invincible = true;
        invincibleTimer = INVINCIBLE_DURATION;
        player.classList.add("invincible");
        cheatTimerEl.textContent = "‡πÇ‡∏´‡∏°‡∏î‡πÇ‡∏Å‡∏á: PHANToM ‡∏≠‡∏°‡∏ï‡∏∞ 10 ‡∏ß‡∏¥ üéÉ";
        messageEl.textContent = "‡πÇ‡∏´‡∏°‡∏î‡πÇ‡∏Å‡∏á‡πÄ‡∏õ‡∏¥‡∏î‡πÅ‡∏•‡πâ‡∏ß! ‡∏ä‡∏ô‡∏≠‡∏∞‡πÑ‡∏£‡∏Å‡πá‡πÑ‡∏°‡πà‡∏ï‡∏≤‡∏¢ 10 ‡∏ß‡∏¥";
      }

      // ‡∏Ñ‡∏µ‡∏¢‡πå‡∏ö‡∏≠‡∏£‡πå‡∏î
      document.addEventListener("keydown", (e) => {
        if (e.code === "Space" || e.code === "ArrowUp") {
          e.preventDefault();
          handleJump();
          registerCheat(e.code); // Space ‡∏ô‡∏±‡∏ö‡πÄ‡∏õ‡πá‡∏ô U
        } else if (e.code === "ArrowDown") {
          e.preventDefault();
          setDuck(true);
          registerCheat(e.code);
        }
      });

      document.addEventListener("keyup", (e) => {
        if (e.code === "ArrowDown") {
          setDuck(false);
        }
      });

      startBtn.addEventListener("click", resetGame);
    })();
  </script>
</body>
</html>
